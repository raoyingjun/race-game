import{E as Sn,V as M,M as se,T as ie,Q as Pe,S as Rt,a as P,R as Mn,P as Cn,b as Ut,L as $t,F as Oe,c as J,d as z,B as zt,e as ge,C as W,f as kn,g as Ye,h as Vt,i as We,j as In,k as Pn,D as Kt,l as me,m as Z,n as De,I as On,o as Dn,O as Xt,p as Yt,q as Nn,r as Fn,s as Wt,t as Zt,u as ye,v as jn,w as Be,x as Hn,y as st,z as qt,A as Gn,G as Bn,H as Qt,J as Un,K as $n,N as zn,U as Vn,W as G,X as Jt,Y as Kn,Z as Xn,_ as Yn,$ as Wn,a0 as en,a1 as Lt,a2 as Zn,a3 as qn,a4 as Qn,a5 as Jn,a6 as es,a7 as ts,a8 as ns,a9 as ss,aa as is,ab as vt,ac as St,ad as Mt,ae as Ct,af as os,ag as rs,ah as as,ai as cs,aj as ls,ak as hs,al as ds,am as us}from"./three-IPLJ6LQC.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const kt={type:"change"},Ue={type:"start"},It={type:"end"},Le=new Mn,Pt=new Cn,ps=Math.cos(70*Ut.DEG2RAD);class fs extends Sn{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new M,this.cursor=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:se.ROTATE,MIDDLE:se.DOLLY,RIGHT:se.PAN},this.touches={ONE:ie.ROTATE,TWO:ie.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(u){u.addEventListener("keydown",He),this._domElementKeyEvents=u},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",He),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(kt),t.update(),i=s.NONE},this.update=function(){const u=new M,b=new Pe().setFromUnitVectors(e.up,new M(0,1,0)),L=b.clone().invert(),S=new M,I=new Pe,ne=new M,K=2*Math.PI;return function(vn=null){const _t=t.object.position;u.copy(_t).sub(t.target),u.applyQuaternion(b),r.setFromVector3(u),t.autoRotate&&i===s.NONE&&he(H(vn)),t.enableDamping?(r.theta+=a.theta*t.dampingFactor,r.phi+=a.phi*t.dampingFactor):(r.theta+=a.theta,r.phi+=a.phi);let U=t.minAzimuthAngle,$=t.maxAzimuthAngle;isFinite(U)&&isFinite($)&&(U<-Math.PI?U+=K:U>Math.PI&&(U-=K),$<-Math.PI?$+=K:$>Math.PI&&($-=K),U<=$?r.theta=Math.max(U,Math.min($,r.theta)):r.theta=r.theta>(U+$)/2?Math.max(U,r.theta):Math.min($,r.theta)),r.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,r.phi)),r.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(h,t.dampingFactor):t.target.add(h),t.target.sub(t.cursor),t.target.clampLength(t.minTargetRadius,t.maxTargetRadius),t.target.add(t.cursor),t.zoomToCursor&&k||t.object.isOrthographicCamera?r.radius=Fe(r.radius):r.radius=Fe(r.radius*l),u.setFromSpherical(r),u.applyQuaternion(L),_t.copy(t.target).add(u),t.object.lookAt(t.target),t.enableDamping===!0?(a.theta*=1-t.dampingFactor,a.phi*=1-t.dampingFactor,h.multiplyScalar(1-t.dampingFactor)):(a.set(0,0,0),h.set(0,0,0));let _e=!1;if(t.zoomToCursor&&k){let ue=null;if(t.object.isPerspectiveCamera){const pe=u.length();ue=Fe(pe*l);const Re=pe-ue;t.object.position.addScaledVector(E,Re),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const pe=new M(v.x,v.y,0);pe.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/l)),t.object.updateProjectionMatrix(),_e=!0;const Re=new M(v.x,v.y,0);Re.unproject(t.object),t.object.position.sub(Re).add(pe),t.object.updateMatrixWorld(),ue=u.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;ue!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(ue).add(t.object.position):(Le.origin.copy(t.object.position),Le.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(Le.direction))<ps?e.lookAt(t.target):(Pt.setFromNormalAndCoplanarPoint(t.object.up,t.target),Le.intersectPlane(Pt,t.target))))}else t.object.isOrthographicCamera&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/l)),t.object.updateProjectionMatrix(),_e=!0);return l=1,k=!1,_e||S.distanceToSquared(t.object.position)>o||8*(1-I.dot(t.object.quaternion))>o||ne.distanceToSquared(t.target)>0?(t.dispatchEvent(kt),S.copy(t.object.position),I.copy(t.object.quaternion),ne.copy(t.target),_e=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",Et),t.domElement.removeEventListener("pointerdown",wt),t.domElement.removeEventListener("pointercancel",de),t.domElement.removeEventListener("wheel",Tt),t.domElement.removeEventListener("pointermove",je),t.domElement.removeEventListener("pointerup",de),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",He),t._domElementKeyEvents=null)};const t=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=s.NONE;const o=1e-6,r=new Rt,a=new Rt;let l=1;const h=new M,d=new P,p=new P,f=new P,m=new P,A=new P,g=new P,y=new P,w=new P,_=new P,E=new M,v=new P;let k=!1;const T=[],j={};function H(u){return u!==null?2*Math.PI/60*t.autoRotateSpeed*u:2*Math.PI/60/60*t.autoRotateSpeed}function V(){return Math.pow(.95,t.zoomSpeed)}function he(u){a.theta-=u}function xe(u){a.phi-=u}const ct=function(){const u=new M;return function(L,S){u.setFromMatrixColumn(S,0),u.multiplyScalar(-L),h.add(u)}}(),lt=function(){const u=new M;return function(L,S){t.screenSpacePanning===!0?u.setFromMatrixColumn(S,1):(u.setFromMatrixColumn(S,0),u.crossVectors(t.object.up,u)),u.multiplyScalar(L),h.add(u)}}(),te=function(){const u=new M;return function(L,S){const I=t.domElement;if(t.object.isPerspectiveCamera){const ne=t.object.position;u.copy(ne).sub(t.target);let K=u.length();K*=Math.tan(t.object.fov/2*Math.PI/180),ct(2*L*K/I.clientHeight,t.object.matrix),lt(2*S*K/I.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(ct(L*(t.object.right-t.object.left)/t.object.zoom/I.clientWidth,t.object.matrix),lt(S*(t.object.top-t.object.bottom)/t.object.zoom/I.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function Ne(u){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?l/=u:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function ht(u){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?l*=u:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function dt(u){if(!t.zoomToCursor)return;k=!0;const b=t.domElement.getBoundingClientRect(),L=u.clientX-b.left,S=u.clientY-b.top,I=b.width,ne=b.height;v.x=L/I*2-1,v.y=-(S/ne)*2+1,E.set(v.x,v.y,1).unproject(t.object).sub(t.object.position).normalize()}function Fe(u){return Math.max(t.minDistance,Math.min(t.maxDistance,u))}function ut(u){d.set(u.clientX,u.clientY)}function dn(u){dt(u),y.set(u.clientX,u.clientY)}function pt(u){m.set(u.clientX,u.clientY)}function un(u){p.set(u.clientX,u.clientY),f.subVectors(p,d).multiplyScalar(t.rotateSpeed);const b=t.domElement;he(2*Math.PI*f.x/b.clientHeight),xe(2*Math.PI*f.y/b.clientHeight),d.copy(p),t.update()}function pn(u){w.set(u.clientX,u.clientY),_.subVectors(w,y),_.y>0?Ne(V()):_.y<0&&ht(V()),y.copy(w),t.update()}function fn(u){A.set(u.clientX,u.clientY),g.subVectors(A,m).multiplyScalar(t.panSpeed),te(g.x,g.y),m.copy(A),t.update()}function mn(u){dt(u),u.deltaY<0?ht(V()):u.deltaY>0&&Ne(V()),t.update()}function gn(u){let b=!1;switch(u.code){case t.keys.UP:u.ctrlKey||u.metaKey||u.shiftKey?xe(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):te(0,t.keyPanSpeed),b=!0;break;case t.keys.BOTTOM:u.ctrlKey||u.metaKey||u.shiftKey?xe(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):te(0,-t.keyPanSpeed),b=!0;break;case t.keys.LEFT:u.ctrlKey||u.metaKey||u.shiftKey?he(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):te(t.keyPanSpeed,0),b=!0;break;case t.keys.RIGHT:u.ctrlKey||u.metaKey||u.shiftKey?he(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):te(-t.keyPanSpeed,0),b=!0;break}b&&(u.preventDefault(),t.update())}function ft(){if(T.length===1)d.set(T[0].pageX,T[0].pageY);else{const u=.5*(T[0].pageX+T[1].pageX),b=.5*(T[0].pageY+T[1].pageY);d.set(u,b)}}function mt(){if(T.length===1)m.set(T[0].pageX,T[0].pageY);else{const u=.5*(T[0].pageX+T[1].pageX),b=.5*(T[0].pageY+T[1].pageY);m.set(u,b)}}function gt(){const u=T[0].pageX-T[1].pageX,b=T[0].pageY-T[1].pageY,L=Math.sqrt(u*u+b*b);y.set(0,L)}function An(){t.enableZoom&&gt(),t.enablePan&&mt()}function bn(){t.enableZoom&&gt(),t.enableRotate&&ft()}function At(u){if(T.length==1)p.set(u.pageX,u.pageY);else{const L=Ge(u),S=.5*(u.pageX+L.x),I=.5*(u.pageY+L.y);p.set(S,I)}f.subVectors(p,d).multiplyScalar(t.rotateSpeed);const b=t.domElement;he(2*Math.PI*f.x/b.clientHeight),xe(2*Math.PI*f.y/b.clientHeight),d.copy(p)}function bt(u){if(T.length===1)A.set(u.pageX,u.pageY);else{const b=Ge(u),L=.5*(u.pageX+b.x),S=.5*(u.pageY+b.y);A.set(L,S)}g.subVectors(A,m).multiplyScalar(t.panSpeed),te(g.x,g.y),m.copy(A)}function yt(u){const b=Ge(u),L=u.pageX-b.x,S=u.pageY-b.y,I=Math.sqrt(L*L+S*S);w.set(0,I),_.set(0,Math.pow(w.y/y.y,t.zoomSpeed)),Ne(_.y),y.copy(w)}function yn(u){t.enableZoom&&yt(u),t.enablePan&&bt(u)}function wn(u){t.enableZoom&&yt(u),t.enableRotate&&At(u)}function wt(u){t.enabled!==!1&&(T.length===0&&(t.domElement.setPointerCapture(u.pointerId),t.domElement.addEventListener("pointermove",je),t.domElement.addEventListener("pointerup",de)),Rn(u),u.pointerType==="touch"?xn(u):Tn(u))}function je(u){t.enabled!==!1&&(u.pointerType==="touch"?_n(u):En(u))}function de(u){Ln(u),T.length===0&&(t.domElement.releasePointerCapture(u.pointerId),t.domElement.removeEventListener("pointermove",je),t.domElement.removeEventListener("pointerup",de)),t.dispatchEvent(It),i=s.NONE}function Tn(u){let b;switch(u.button){case 0:b=t.mouseButtons.LEFT;break;case 1:b=t.mouseButtons.MIDDLE;break;case 2:b=t.mouseButtons.RIGHT;break;default:b=-1}switch(b){case se.DOLLY:if(t.enableZoom===!1)return;dn(u),i=s.DOLLY;break;case se.ROTATE:if(u.ctrlKey||u.metaKey||u.shiftKey){if(t.enablePan===!1)return;pt(u),i=s.PAN}else{if(t.enableRotate===!1)return;ut(u),i=s.ROTATE}break;case se.PAN:if(u.ctrlKey||u.metaKey||u.shiftKey){if(t.enableRotate===!1)return;ut(u),i=s.ROTATE}else{if(t.enablePan===!1)return;pt(u),i=s.PAN}break;default:i=s.NONE}i!==s.NONE&&t.dispatchEvent(Ue)}function En(u){switch(i){case s.ROTATE:if(t.enableRotate===!1)return;un(u);break;case s.DOLLY:if(t.enableZoom===!1)return;pn(u);break;case s.PAN:if(t.enablePan===!1)return;fn(u);break}}function Tt(u){t.enabled===!1||t.enableZoom===!1||i!==s.NONE||(u.preventDefault(),t.dispatchEvent(Ue),mn(u),t.dispatchEvent(It))}function He(u){t.enabled===!1||t.enablePan===!1||gn(u)}function xn(u){switch(xt(u),T.length){case 1:switch(t.touches.ONE){case ie.ROTATE:if(t.enableRotate===!1)return;ft(),i=s.TOUCH_ROTATE;break;case ie.PAN:if(t.enablePan===!1)return;mt(),i=s.TOUCH_PAN;break;default:i=s.NONE}break;case 2:switch(t.touches.TWO){case ie.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;An(),i=s.TOUCH_DOLLY_PAN;break;case ie.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;bn(),i=s.TOUCH_DOLLY_ROTATE;break;default:i=s.NONE}break;default:i=s.NONE}i!==s.NONE&&t.dispatchEvent(Ue)}function _n(u){switch(xt(u),i){case s.TOUCH_ROTATE:if(t.enableRotate===!1)return;At(u),t.update();break;case s.TOUCH_PAN:if(t.enablePan===!1)return;bt(u),t.update();break;case s.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;yn(u),t.update();break;case s.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;wn(u),t.update();break;default:i=s.NONE}}function Et(u){t.enabled!==!1&&u.preventDefault()}function Rn(u){T.push(u)}function Ln(u){delete j[u.pointerId];for(let b=0;b<T.length;b++)if(T[b].pointerId==u.pointerId){T.splice(b,1);return}}function xt(u){let b=j[u.pointerId];b===void 0&&(b=new P,j[u.pointerId]=b),b.set(u.pageX,u.pageY)}function Ge(u){const b=u.pointerId===T[0].pointerId?T[1]:T[0];return j[b.pointerId]}t.domElement.addEventListener("contextmenu",Et),t.domElement.addEventListener("pointerdown",wt),t.domElement.addEventListener("pointercancel",de),t.domElement.addEventListener("wheel",Tt,{passive:!1}),this.update()}}const $e=new WeakMap;class ms extends $t{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,t,s){const i=new Oe(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,o=>{this.parse(o,n,s)},t,s)}parse(e,n,t){this.decodeDracoFile(e,n,null,null,J).catch(t)}decodeDracoFile(e,n,t,s,i=z){const o={attributeIDs:t||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!t,vertexColorSpace:i};return this.decodeGeometry(e,o).then(n)}decodeGeometry(e,n){const t=JSON.stringify(n);if($e.has(e)){const a=$e.get(e);if(a.key===t)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const i=this.workerNextTaskID++,o=e.byteLength,r=this._getWorker(i,o).then(a=>(s=a,new Promise((l,h)=>{s._callbacks[i]={resolve:l,reject:h},s.postMessage({type:"decode",id:i,taskConfig:n,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return r.catch(()=>!0).then(()=>{s&&i&&this._releaseTask(s,i)}),$e.set(e,{key:t,promise:r}),r}_createGeometry(e){const n=new zt;e.index&&n.setIndex(new ge(e.index.array,1));for(let t=0;t<e.attributes.length;t++){const s=e.attributes[t],i=s.name,o=s.array,r=s.itemSize,a=new ge(o,r);i==="color"&&(this._assignVertexColorSpace(a,s.vertexColorSpace),a.normalized=!(o instanceof Float32Array)),n.setAttribute(i,a)}return n}_assignVertexColorSpace(e,n){if(n!==J)return;const t=new W;for(let s=0,i=e.count;s<i;s++)t.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,t.r,t.g,t.b)}_loadLibrary(e,n){const t=new Oe(this.manager);return t.setPath(this.decoderPath),t.setResponseType(n),t.setWithCredentials(this.withCredentials),new Promise((s,i)=>{t.load(e,s,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(t=>{const s=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=gs.toString(),o=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(i){const o=i.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,i){return s._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskCosts[e]=n,t._taskLoad+=n,t})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function gs(){let c,e;onmessage=function(o){const r=o.data;switch(r.type){case"init":c=r.decoderConfig,e=new Promise(function(h){c.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(c)});break;case"decode":const a=r.buffer,l=r.taskConfig;e.then(h=>{const d=h.draco,p=new d.Decoder;try{const f=n(d,p,new Int8Array(a),l),m=f.attributes.map(A=>A.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:r.id,error:f.message})}finally{d.destroy(p)}});break}};function n(o,r,a,l){const h=l.attributeIDs,d=l.attributeTypes;let p,f;const m=r.GetEncodedGeometryType(a);if(m===o.TRIANGULAR_MESH)p=new o.Mesh,f=r.DecodeArrayToMesh(a,a.byteLength,p);else if(m===o.POINT_CLOUD)p=new o.PointCloud,f=r.DecodeArrayToPointCloud(a,a.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const A={index:null,attributes:[]};for(const g in h){const y=self[d[g]];let w,_;if(l.useUniqueIDs)_=h[g],w=r.GetAttributeByUniqueId(p,_);else{if(_=r.GetAttributeId(p,o[h[g]]),_===-1)continue;w=r.GetAttribute(p,_)}const E=s(o,r,p,g,y,w);g==="color"&&(E.vertexColorSpace=l.vertexColorSpace),A.attributes.push(E)}return m===o.TRIANGULAR_MESH&&(A.index=t(o,r,p)),o.destroy(p),A}function t(o,r,a){const h=a.num_faces()*3,d=h*4,p=o._malloc(d);r.GetTrianglesUInt32Array(a,d,p);const f=new Uint32Array(o.HEAPF32.buffer,p,h).slice();return o._free(p),{array:f,itemSize:1}}function s(o,r,a,l,h,d){const p=d.num_components(),m=a.num_points()*p,A=m*h.BYTES_PER_ELEMENT,g=i(o,h),y=o._malloc(A);r.GetAttributeDataArrayForAllPoints(a,d,g,A,y);const w=new h(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:l,array:w,itemSize:p}}function i(o,r){switch(r){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}function Ot(c,e){if(e===kn)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),c;if(e===Ye||e===Vt){let n=c.getIndex();if(n===null){const o=[],r=c.getAttribute("position");if(r!==void 0){for(let a=0;a<r.count;a++)o.push(a);c.setIndex(o),n=c.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c}const t=n.count-2,s=[];if(e===Ye)for(let o=1;o<=t;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(let o=0;o<t;o++)o%2===0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=c.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),c}class As extends $t{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Es(n)}),this.register(function(n){return new Cs(n)}),this.register(function(n){return new ks(n)}),this.register(function(n){return new Is(n)}),this.register(function(n){return new _s(n)}),this.register(function(n){return new Rs(n)}),this.register(function(n){return new Ls(n)}),this.register(function(n){return new vs(n)}),this.register(function(n){return new Ts(n)}),this.register(function(n){return new Ss(n)}),this.register(function(n){return new xs(n)}),this.register(function(n){return new Ms(n)}),this.register(function(n){return new ys(n)}),this.register(function(n){return new Ps(n)}),this.register(function(n){return new Os(n)})}load(e,n,t,s){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=We.extractUrlBase(e),this.manager.itemStart(e);const r=function(l){s?s(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},a=new Oe(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i.parse(l,o,function(h){n(h),i.manager.itemEnd(e)},r)}catch(h){r(h)}},t,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,s){let i;const o={},r={},a=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===tn){try{o[x.KHR_BINARY_GLTF]=new Ds(e)}catch(d){s&&s(d);return}i=JSON.parse(o[x.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Ys(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](l);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,o[d.name]=!0}if(i.extensionsUsed)for(let h=0;h<i.extensionsUsed.length;++h){const d=i.extensionsUsed[h],p=i.extensionsRequired||[];switch(d){case x.KHR_MATERIALS_UNLIT:o[d]=new ws;break;case x.KHR_DRACO_MESH_COMPRESSION:o[d]=new Ns(i,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:o[d]=new Fs;break;case x.KHR_MESH_QUANTIZATION:o[d]=new js;break;default:p.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(o),l.setPlugins(r),l.parse(t,s)}parseAsync(e,n){const t=this;return new Promise(function(s,i){t.parse(e,n,s,i)})}}function bs(){let c={};return{get:function(e){return c[e]},add:function(e,n){c[e]=n},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ys{constructor(e){this.parser=e,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,s=n.length;t<s;t++){const i=n[t];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let s=n.cache.get(t);if(s)return s;const i=n.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const h=new W(16777215);a.color!==void 0&&h.setRGB(a.color[0],a.color[1],a.color[2],z);const d=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Kt(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Pn(h),l.distance=d;break;case"spot":l=new In(h),l.distance=d,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,Y(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=n.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),n.cache.add(t,s),s}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,i=t.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(a){return t._getNodeRef(n.cache,r,a)})}}class ws{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return me}extendParams(e,n,t){const s=[];e.color=new W(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],z),e.opacity=o[3]}i.baseColorTexture!==void 0&&s.push(t.assignTexture(e,"map",i.baseColorTexture,J))}return Promise.all(s)}}class Ts{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class Es{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(n.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(t.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const r=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new P(r,r)}return Promise.all(i)}}class xs{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(n.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(n.iridescenceIOR=o.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class _s{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new W(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const r=o.sheenColorFactor;n.sheenColor.setRGB(r[0],r[1],r[2],z)}return o.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(t.assignTexture(n,"sheenColorMap",o.sheenColorTexture,J)),o.sheenRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class Rs{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(n.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(t.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class Ls{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];n.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(t.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const r=o.attenuationColor||[1,1,1];return n.attenuationColor=new W().setRGB(r[0],r[1],r[2],z),Promise.all(i)}}class vs{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Ss{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];n.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(t.assignTexture(n,"specularIntensityMap",o.specularTexture));const r=o.specularColorFactor||[1,1,1];return n.specularColor=new W().setRGB(r[0],r[1],r[2],z),o.specularColorTexture!==void 0&&i.push(t.assignTexture(n,"specularColorMap",o.specularColorTexture,J)),Promise.all(i)}}class Ms{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Z}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(n.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(n.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(t.assignTexture(n,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class Cs{constructor(e){this.parser=e,this.name=x.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,s=t.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,i.source,o)}}class ks{constructor(e){this.parser=e,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[n])return null;const o=i.extensions[n],r=s.images[o.source];let a=t.textureLoader;if(r.uri){const l=t.options.manager.getHandler(r.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return t.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Is{constructor(e){this.parser=e,this.name=x.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[n])return null;const o=i.extensions[n],r=s.images[o.source];let a=t.textureLoader;if(r.uri){const l=t.options.manager.getHandler(r.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return t.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Ps{constructor(e){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const s=t.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(r){const a=s.byteOffset||0,l=s.byteLength||0,h=s.count,d=s.byteStride,p=new Uint8Array(r,a,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,p,s.mode,s.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(f),h,d,p,s.mode,s.filter),f})})}else return null}}class Os{constructor(e){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const s=n.meshes[t.mesh];for(const l of s.primitives)if(l.mode!==N.TRIANGLES&&l.mode!==N.TRIANGLE_STRIP&&l.mode!==N.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=t.extensions[this.name].attributes,r=[],a={};for(const l in o)r.push(this.parser.getDependency("accessor",o[l]).then(h=>(a[l]=h,a[l])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(l=>{const h=l.pop(),d=h.isGroup?h.children:[h],p=l[0].count,f=[];for(const m of d){const A=new De,g=new M,y=new Pe,w=new M(1,1,1),_=new On(m.geometry,m.material,p);for(let E=0;E<p;E++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,E),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,E),a.SCALE&&w.fromBufferAttribute(a.SCALE,E),_.setMatrixAt(E,A.compose(g,y,w));for(const E in a)if(E==="_COLOR_0"){const v=a[E];_.instanceColor=new Dn(v.array,v.itemSize,v.normalized)}else E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&m.geometry.setAttribute(E,a[E]);Xt.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),f.push(_)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const tn="glTF",fe=12,Dt={JSON:1313821514,BIN:5130562};class Ds{constructor(e){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,fe),t=new TextDecoder;if(this.header={magic:t.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==tn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-fe,i=new DataView(e,fe);let o=0;for(;o<s;){const r=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,a===Dt.JSON){const l=new Uint8Array(e,fe+o,r);this.content=t.decode(l)}else if(a===Dt.BIN){const l=fe+o;this.body=e.slice(l,l+r)}o+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ns{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,r={},a={},l={};for(const h in o){const d=Ze[h]||h.toLowerCase();r[d]=o[h]}for(const h in e.attributes){const d=Ze[h]||h.toLowerCase();if(o[h]!==void 0){const p=t.accessors[e.attributes[h]],f=re[p.componentType];l[d]=f.name,a[d]=p.normalized===!0}}return n.getDependency("bufferView",i).then(function(h){return new Promise(function(d){s.decodeDracoFile(h,function(p){for(const f in p.attributes){const m=p.attributes[f],A=a[f];A!==void 0&&(m.normalized=A)}d(p)},r,l)})})}}class Fs{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class js{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class nn extends as{constructor(e,n,t,s){super(e,n,t,s)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,s=this.valueSize,i=e*s*3+s;for(let o=0;o!==s;o++)n[o]=t[i+o];return n}interpolate_(e,n,t,s){const i=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=r*2,l=r*3,h=s-n,d=(t-n)/h,p=d*d,f=p*d,m=e*l,A=m-l,g=-2*f+3*p,y=f-p,w=1-g,_=y-p+d;for(let E=0;E!==r;E++){const v=o[A+E+r],k=o[A+E+a]*h,T=o[m+E+r],j=o[m+E]*h;i[E]=w*v+_*k+g*T+y*j}return i}}const Hs=new Pe;class Gs extends nn{interpolate_(e,n,t,s){const i=super.interpolate_(e,n,t,s);return Hs.fromArray(i).normalize().toArray(i),i}}const N={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},re={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Nt={9728:Zn,9729:Wt,9984:qn,9985:Qn,9986:Jn,9987:Zt},Ft={33071:es,33648:ts,10497:ye},ze={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ze={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},X={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bs={CUBICSPLINE:void 0,LINEAR:en,STEP:ns},Ve={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Us(c){return c.DefaultMaterial===void 0&&(c.DefaultMaterial=new st({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ss})),c.DefaultMaterial}function q(c,e,n){for(const t in n.extensions)c[t]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function Y(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function $s(c,e,n){let t=!1,s=!1,i=!1;for(let l=0,h=e.length;l<h;l++){const d=e[l];if(d.POSITION!==void 0&&(t=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(i=!0),t&&s&&i)break}if(!t&&!s&&!i)return Promise.resolve(c);const o=[],r=[],a=[];for(let l=0,h=e.length;l<h;l++){const d=e[l];if(t){const p=d.POSITION!==void 0?n.getDependency("accessor",d.POSITION):c.attributes.position;o.push(p)}if(s){const p=d.NORMAL!==void 0?n.getDependency("accessor",d.NORMAL):c.attributes.normal;r.push(p)}if(i){const p=d.COLOR_0!==void 0?n.getDependency("accessor",d.COLOR_0):c.attributes.color;a.push(p)}}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(a)]).then(function(l){const h=l[0],d=l[1],p=l[2];return t&&(c.morphAttributes.position=h),s&&(c.morphAttributes.normal=d),i&&(c.morphAttributes.color=p),c.morphTargetsRelative=!0,c})}function zs(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let n=0,t=e.weights.length;n<t;n++)c.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(c.morphTargetInfluences.length===n.length){c.morphTargetDictionary={};for(let t=0,s=n.length;t<s;t++)c.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vs(c){let e;const n=c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Ke(n.attributes):e=c.indices+":"+Ke(c.attributes)+":"+c.mode,c.targets!==void 0)for(let t=0,s=c.targets.length;t<s;t++)e+=":"+Ke(c.targets[t]);return e}function Ke(c){let e="";const n=Object.keys(c).sort();for(let t=0,s=n.length;t<s;t++)e+=n[t]+":"+c[n[t]]+";";return e}function qe(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ks(c){return c.search(/\.jpe?g($|\?)/i)>0||c.search(/^data\:image\/jpeg/)===0?"image/jpeg":c.search(/\.webp($|\?)/i)>0||c.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Xs=new De;class Ys{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new bs,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,s=!1,i=-1;typeof navigator<"u"&&(t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,i=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||t||s&&i<98?this.textureLoader=new Yt(this.options.manager):this.textureLoader=new Nn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Oe(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(o){const r={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:t,userData:{}};return q(i,r,s),Y(r,s),Promise.all(t._invokeAll(function(a){return a.afterRoot&&a.afterRoot(r)})).then(function(){e(r)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let s=0,i=n.length;s<i;s++){const o=n[s].joints;for(let r=0,a=o.length;r<a;r++)e[o[r]].isBone=!0}for(let s=0,i=e.length;s<i;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(t[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const s=t.clone(),i=(o,r)=>{const a=this.associations.get(o);a!=null&&this.associations.set(r,a);for(const[l,h]of o.children.entries())i(h,r.children[l])};return i(t,s),s.name+="_instance_"+e.uses[n]++,s}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const s=e(n[t]);if(s)return s}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let s=0;s<n.length;s++){const i=e(n[s]);i&&t.push(i)}return t}getDependency(e,n){const t=e+":"+n;let s=this.cache.get(t);if(!s){switch(e){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,n)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(t,s)}return s}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(i,o){return t.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,o){t.load(We.resolveURL(n.uri,s.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const s=n.byteLength||0,i=n.byteOffset||0;return t.slice(i,i+s)})}loadAccessor(e){const n=this,t=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=ze[s.type],r=re[s.componentType],a=s.normalized===!0,l=new r(s.count*o);return Promise.resolve(new ge(l,o,a))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(o){const r=o[0],a=ze[s.type],l=re[s.componentType],h=l.BYTES_PER_ELEMENT,d=h*a,p=s.byteOffset||0,f=s.bufferView!==void 0?t.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let A,g;if(f&&f!==d){const y=Math.floor(p/f),w="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=n.cache.get(w);_||(A=new l(r,y*f,s.count*f/h),_=new Fn(A,f/h),n.cache.add(w,_)),g=new is(_,a,p%f/h,m)}else r===null?A=new l(s.count*a):A=new l(r,p,s.count*a),g=new ge(A,a,m);if(s.sparse!==void 0){const y=ze.SCALAR,w=re[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,E=s.sparse.values.byteOffset||0,v=new w(o[1],_,s.sparse.count*y),k=new l(o[2],E,s.sparse.count*a);r!==null&&(g=new ge(g.array.slice(),g.itemSize,g.normalized));for(let T=0,j=v.length;T<j;T++){const H=v[T];if(g.setX(H,k[T*a]),a>=2&&g.setY(H,k[T*a+1]),a>=3&&g.setZ(H,k[T*a+2]),a>=4&&g.setW(H,k[T*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const n=this.json,t=this.options,i=n.textures[e].source,o=n.images[i];let r=this.textureLoader;if(o.uri){const a=t.manager.getHandler(o.uri);a!==null&&(r=a)}return this.loadTextureImage(e,i,r)}loadTextureImage(e,n,t){const s=this,i=this.json,o=i.textures[e],r=i.images[n],a=(r.uri||r.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(n,t).then(function(h){h.flipY=!1,h.name=o.name||r.name||"",h.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(h.name=r.uri);const p=(i.samplers||{})[o.sampler]||{};return h.magFilter=Nt[p.magFilter]||Wt,h.minFilter=Nt[p.minFilter]||Zt,h.wrapS=Ft[p.wrapS]||ye,h.wrapT=Ft[p.wrapT]||ye,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,n){const t=this,s=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=s.images[e],r=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(o.bufferView!==void 0)a=t.getDependency("bufferView",o.bufferView).then(function(d){l=!0;const p=new Blob([d],{type:o.mimeType});return a=r.createObjectURL(p),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then(function(d){return new Promise(function(p,f){let m=p;n.isImageBitmapLoader===!0&&(m=function(A){const g=new vt(A);g.needsUpdate=!0,p(g)}),n.load(We.resolveURL(d,i.path),m,void 0,f)})}).then(function(d){return l===!0&&r.revokeObjectURL(a),d.userData.mimeType=o.mimeType||Ks(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),d});return this.sourceCache[e]=h,h}assignTexture(e,n,t,s){const i=this;return this.getDependency("texture",t.index).then(function(o){if(!o)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(o=o.clone(),o.channel=t.texCoord),i.extensions[x.KHR_TEXTURE_TRANSFORM]){const r=t.extensions!==void 0?t.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const a=i.associations.get(o);o=i.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(o,r),i.associations.set(o,a)}}return s!==void 0&&(o.colorSpace=s),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const s=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,o=n.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+t.uuid;let a=this.cache.get(r);a||(a=new jn,Be.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,a.sizeAttenuation=!1,this.cache.add(r,a)),t=a}else if(e.isLine){const r="LineBasicMaterial:"+t.uuid;let a=this.cache.get(r);a||(a=new Hn,Be.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,this.cache.add(r,a)),t=a}if(s||i||o){let r="ClonedMaterial:"+t.uuid+":";s&&(r+="derivative-tangents:"),i&&(r+="vertex-colors:"),o&&(r+="flat-shading:");let a=this.cache.get(r);a||(a=t.clone(),i&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(r,a),this.associations.set(a,this.associations.get(t))),t=a}e.material=t}getMaterialType(){return st}loadMaterial(e){const n=this,t=this.json,s=this.extensions,i=t.materials[e];let o;const r={},a=i.extensions||{},l=[];if(a[x.KHR_MATERIALS_UNLIT]){const d=s[x.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),l.push(d.extendParams(r,i,n))}else{const d=i.pbrMetallicRoughness||{};if(r.color=new W(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;r.color.setRGB(p[0],p[1],p[2],z),r.opacity=p[3]}d.baseColorTexture!==void 0&&l.push(n.assignTexture(r,"map",d.baseColorTexture,J)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),l.push(n.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,r)})))}i.doubleSided===!0&&(r.side=qt);const h=i.alphaMode||Ve.OPAQUE;if(h===Ve.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,h===Ve.MASK&&(r.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==me&&(l.push(n.assignTexture(r,"normalMap",i.normalTexture)),r.normalScale=new P(1,1),i.normalTexture.scale!==void 0)){const d=i.normalTexture.scale;r.normalScale.set(d,d)}if(i.occlusionTexture!==void 0&&o!==me&&(l.push(n.assignTexture(r,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==me){const d=i.emissiveFactor;r.emissive=new W().setRGB(d[0],d[1],d[2],z)}return i.emissiveTexture!==void 0&&o!==me&&l.push(n.assignTexture(r,"emissiveMap",i.emissiveTexture,J)),Promise.all(l).then(function(){const d=new o(r);return i.name&&(d.name=i.name),Y(d,i),n.associations.set(d,{materials:e}),i.extensions&&q(s,d,i),d})}createUniqueName(e){const n=Gn.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,t=this.extensions,s=this.primitiveCache;function i(r){return t[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,n).then(function(a){return jt(a,r,n)})}const o=[];for(let r=0,a=e.length;r<a;r++){const l=e[r],h=Vs(l),d=s[h];if(d)o.push(d.promise);else{let p;l.extensions&&l.extensions[x.KHR_DRACO_MESH_COMPRESSION]?p=i(l):p=jt(new zt,l,n),s[h]={primitive:l,promise:p},o.push(p)}}return Promise.all(o)}loadMesh(e){const n=this,t=this.json,s=this.extensions,i=t.meshes[e],o=i.primitives,r=[];for(let a=0,l=o.length;a<l;a++){const h=o[a].material===void 0?Us(this.cache):this.getDependency("material",o[a].material);r.push(h)}return r.push(n.loadGeometries(o)),Promise.all(r).then(function(a){const l=a.slice(0,a.length-1),h=a[a.length-1],d=[];for(let f=0,m=h.length;f<m;f++){const A=h[f],g=o[f];let y;const w=l[f];if(g.mode===N.TRIANGLES||g.mode===N.TRIANGLE_STRIP||g.mode===N.TRIANGLE_FAN||g.mode===void 0)y=i.isSkinnedMesh===!0?new Bn(A,w):new Qt(A,w),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),g.mode===N.TRIANGLE_STRIP?y.geometry=Ot(y.geometry,Vt):g.mode===N.TRIANGLE_FAN&&(y.geometry=Ot(y.geometry,Ye));else if(g.mode===N.LINES)y=new Un(A,w);else if(g.mode===N.LINE_STRIP)y=new $n(A,w);else if(g.mode===N.LINE_LOOP)y=new zn(A,w);else if(g.mode===N.POINTS)y=new Vn(A,w);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(y.geometry.morphAttributes).length>0&&zs(y,i),y.name=n.createUniqueName(i.name||"mesh_"+e),Y(y,i),g.extensions&&q(s,y,g),n.assignFinalMaterial(y),d.push(y)}for(let f=0,m=d.length;f<m;f++)n.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return i.extensions&&q(s,d[0],i),d[0];const p=new G;i.extensions&&q(s,p,i),n.associations.set(p,{meshes:e});for(let f=0,m=d.length;f<m;f++)p.add(d[f]);return p})}loadCamera(e){let n;const t=this.json.cameras[e],s=t[t.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?n=new Jt(Ut.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):t.type==="orthographic"&&(n=new Kn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),Y(n,t),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],t=[];for(let s=0,i=n.joints.length;s<i;s++)t.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",n.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(s){const i=s.pop(),o=s,r=[],a=[];for(let l=0,h=o.length;l<h;l++){const d=o[l];if(d){r.push(d);const p=new De;i!==null&&p.fromArray(i.array,l*16),a.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new Xn(r,a)})}loadAnimation(e){const n=this.json,t=this,s=n.animations[e],i=s.name?s.name:"animation_"+e,o=[],r=[],a=[],l=[],h=[];for(let d=0,p=s.channels.length;d<p;d++){const f=s.channels[d],m=s.samplers[f.sampler],A=f.target,g=A.node,y=s.parameters!==void 0?s.parameters[m.input]:m.input,w=s.parameters!==void 0?s.parameters[m.output]:m.output;A.node!==void 0&&(o.push(this.getDependency("node",g)),r.push(this.getDependency("accessor",y)),a.push(this.getDependency("accessor",w)),l.push(m),h.push(A))}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(a),Promise.all(l),Promise.all(h)]).then(function(d){const p=d[0],f=d[1],m=d[2],A=d[3],g=d[4],y=[];for(let w=0,_=p.length;w<_;w++){const E=p[w],v=f[w],k=m[w],T=A[w],j=g[w];if(E===void 0)continue;E.updateMatrix&&E.updateMatrix();const H=t._createAnimationTracks(E,v,k,T,j);if(H)for(let V=0;V<H.length;V++)y.push(H[V])}return new Yn(i,void 0,y)})}createNodeMesh(e){const n=this.json,t=this,s=n.nodes[e];return s.mesh===void 0?null:t.getDependency("mesh",s.mesh).then(function(i){const o=t._getNodeRef(t.meshCache,s.mesh,i);return s.weights!==void 0&&o.traverse(function(r){if(r.isMesh)for(let a=0,l=s.weights.length;a<l;a++)r.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const n=this.json,t=this,s=n.nodes[e],i=t._loadNodeShallow(e),o=[],r=s.children||[];for(let l=0,h=r.length;l<h;l++)o.push(t.getDependency("node",r[l]));const a=s.skin===void 0?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([i,Promise.all(o),a]).then(function(l){const h=l[0],d=l[1],p=l[2];p!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(p,Xs)});for(let f=0,m=d.length;f<m;f++)h.add(d[f]);return h})}_loadNodeShallow(e){const n=this.json,t=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=n.nodes[e],o=i.name?s.createUniqueName(i.name):"",r=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&r.push(a),i.camera!==void 0&&r.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){r.push(l)}),this.nodeCache[e]=Promise.all(r).then(function(l){let h;if(i.isBone===!0?h=new Wn:l.length>1?h=new G:l.length===1?h=l[0]:h=new Xt,h!==l[0])for(let d=0,p=l.length;d<p;d++)h.add(l[d]);if(i.name&&(h.userData.name=i.name,h.name=o),Y(h,i),i.extensions&&q(t,h,i),i.matrix!==void 0){const d=new De;d.fromArray(i.matrix),h.applyMatrix4(d)}else i.translation!==void 0&&h.position.fromArray(i.translation),i.rotation!==void 0&&h.quaternion.fromArray(i.rotation),i.scale!==void 0&&h.scale.fromArray(i.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],s=this,i=new G;t.name&&(i.name=s.createUniqueName(t.name)),Y(i,t),t.extensions&&q(n,i,t);const o=t.nodes||[],r=[];for(let a=0,l=o.length;a<l;a++)r.push(s.getDependency("node",o[a]));return Promise.all(r).then(function(a){for(let h=0,d=a.length;h<d;h++)i.add(a[h]);const l=h=>{const d=new Map;for(const[p,f]of s.associations)(p instanceof Be||p instanceof vt)&&d.set(p,f);return h.traverse(p=>{const f=s.associations.get(p);f!=null&&d.set(p,f)}),d};return s.associations=l(i),i})}_createAnimationTracks(e,n,t,s,i){const o=[],r=e.name?e.name:e.uuid,a=[];X[i.path]===X.weights?e.traverse(function(p){p.morphTargetInfluences&&a.push(p.name?p.name:p.uuid)}):a.push(r);let l;switch(X[i.path]){case X.weights:l=Mt;break;case X.rotation:l=Ct;break;case X.position:case X.scale:l=St;break;default:switch(t.itemSize){case 1:l=Mt;break;case 2:case 3:default:l=St;break}break}const h=s.interpolation!==void 0?Bs[s.interpolation]:en,d=this._getArrayFromAccessor(t);for(let p=0,f=a.length;p<f;p++){const m=new l(a[p]+"."+X[i.path],n.array,d,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const t=qe(n.constructor),s=new Float32Array(n.length);for(let i=0,o=n.length;i<o;i++)s[i]=n[i]*t;n=s}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const s=this instanceof Ct?Gs:nn;return new s(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ws(c,e,n){const t=e.attributes,s=new os;if(t.POSITION!==void 0){const r=n.json.accessors[t.POSITION],a=r.min,l=r.max;if(a!==void 0&&l!==void 0){if(s.set(new M(a[0],a[1],a[2]),new M(l[0],l[1],l[2])),r.normalized){const h=qe(re[r.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const r=new M,a=new M;for(let l=0,h=i.length;l<h;l++){const d=i[l];if(d.POSITION!==void 0){const p=n.json.accessors[d.POSITION],f=p.min,m=p.max;if(f!==void 0&&m!==void 0){if(a.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),a.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),a.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),p.normalized){const A=qe(re[p.componentType]);a.multiplyScalar(A)}r.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(r)}c.boundingBox=s;const o=new rs;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,c.boundingSphere=o}function jt(c,e,n){const t=e.attributes,s=[];function i(o,r){return n.getDependency("accessor",o).then(function(a){c.setAttribute(r,a)})}for(const o in t){const r=Ze[o]||o.toLowerCase();r in c.attributes||s.push(i(t[o],r))}if(e.indices!==void 0&&!c.index){const o=n.getDependency("accessor",e.indices).then(function(r){c.setIndex(r)});s.push(o)}return Lt.workingColorSpace!==z&&"COLOR_0"in t&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Lt.workingColorSpace}" not supported.`),Y(c,e),Ws(c,e,n),Promise.all(s).then(function(){return e.targets!==void 0?$s(c,e.targets,n):c})}const ee=()=>{const c=window.innerWidth,e=window.innerHeight,n=c/e;return{width:c,height:e,ratio:n}},Zs=(c,e)=>{const{loaded:n,total:t,lengthComputable:s}=c;let i=document.getElementById("tempMask");i||(i=document.createElement("div"),i.style.position="absolute",i.style.inset="0",i.style.zIndex="10",i.style.color="orange",i.style.backgroundColor="rgba(255, 255, 255, .5)",i.id="tempMask",i.innerHTML="");let o=document.getElementById("pid:"+e);o||(o=document.createElement("p"),o.innerHTML=`loading model [${e}] progress`,o.id="pid:"+e);let r=document.getElementById("progressid:"+e);r||(r=document.createElement("progress"),r.max=100,r.value=0,r.id="progressid:"+e),o.appendChild(r),i.appendChild(o),document.body.appendChild(i),r.value=n/t*100},qs=()=>{Je('progress[value="100"]').length===7&&setTimeout(()=>document.body.removeChild(Ce("tempMask")),1e3)},Qs=(c,e=!0)=>{const n=new As;if(e){const t=new ms;t.setDecoderPath("./draco/"),n.setDRACOLoader(t)}return new Promise((t,s)=>{n.load(c,i=>{t(i),qs()},i=>Zs(i,c),s)})},Qe=(c,e)=>Math.floor(Math.floor((e-c+1)*Math.random())+c),Js=(...c)=>"#"+c.map(e=>e.toString(16).padStart(2,"0")).join(""),it=(c,e)=>{const{width:n,height:t}=ee();return{x:n/2-(n-c),y:(t/2-(t-e))*-1}},ce=({from:c,to:e,onStep:n,onComplete:t,step:s=50})=>{const i=100*D.animationRatio;e*=i,c*=i;const o=(e-c)/s*D.animationRatio,r=()=>{c=parseFloat(c.toFixed(2)),e=parseFloat(e.toFixed(2)),c===e?t&&t(e,c):c!==e&&(c+=o,Math.abs(c-e)<Math.abs(o)&&(c=e),n&&n(c/i),requestAnimationFrame(r))};r()},ei=c=>`/resource/${c}.gltf`,ti=async c=>{const{filename:e}=c,n=new URL(ei(e),location.href).href,t=new G;return t.add((await Qs(n,!0)).scene),t.userData=c,t},sn=async c=>c.map(async e=>await ti(e)),ni=c=>c.children[Qe(0,c.children.length-1)].clone(),Ce=c=>document.getElementById(c),Je=c=>document.querySelectorAll(c),si=(c,e=300)=>{let n;return()=>{clearTimeout(n),n=setTimeout(c,e)}},ii=async c=>new Promise((e,n)=>new Yt().load(`/resource/textures/${c}.png`,e,null,n)),oi=new cs,D={fps:60,fpsRatio:2.4,animationRatio:2.4};let O=c=>{if(!O.ready)if(O.checkFpsTimes++<O.checkFpsThreshold){let e=1/(oi.getDelta()||1);e=e>144?144:e,e=e<60?60:e,O.avgFps+=e}else{let e=O.avgFps/O.checkFpsThreshold;e=[60,75,90,120,144].find(t=>e>t-15&&e<t+15);const n=144/e;D.fps=e,D.fpsRatio=n,D.animationRatio=n,O.ready=!0,c&&c()}};O.checkFpsThreshold=60;O.checkFpsTimes=0;O.avgFps=0;O.ready=!1;const ri=100,ai=1,ci=5e3;/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class B{constructor(e,n,t,s,i="div"){this.parent=e,this.object=n,this.property=t,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),B.nextNameID=B.nextNameID||0,this.$name.id="lil-gui-name-"+ ++B.nextNameID,this.$widget=document.createElement(i),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(t)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const n=this.parent.add(this.object,this.property,e);return n.name(this._name),this.destroy(),n}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class li extends B{constructor(e,n,t){super(e,n,t,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function et(c){let e,n;return(e=c.match(/(#|0x)?([a-f0-9]{6})/i))?n=e[2]:(e=c.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?n=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=c.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!n&&"#"+n}const hi={isPrimitive:!0,match:c=>typeof c=="string",fromHexString:et,toHexString:et},we={isPrimitive:!0,match:c=>typeof c=="number",fromHexString:c=>parseInt(c.substring(1),16),toHexString:c=>"#"+c.toString(16).padStart(6,0)},di={isPrimitive:!1,match:Array.isArray,fromHexString(c,e,n=1){const t=we.fromHexString(c);e[0]=(t>>16&255)/255*n,e[1]=(t>>8&255)/255*n,e[2]=(255&t)/255*n},toHexString:([c,e,n],t=1)=>we.toHexString(c*(t=255/t)<<16^e*t<<8^n*t<<0)},ui={isPrimitive:!1,match:c=>Object(c)===c,fromHexString(c,e,n=1){const t=we.fromHexString(c);e.r=(t>>16&255)/255*n,e.g=(t>>8&255)/255*n,e.b=(255&t)/255*n},toHexString:({r:c,g:e,b:n},t=1)=>we.toHexString(c*(t=255/t)<<16^e*t<<8^n*t<<0)},pi=[hi,we,di,ui];class fi extends B{constructor(e,n,t,s){var i;super(e,n,t,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(i=this.initialValue,pi.find(o=>o.match(i))),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const o=et(this.$text.value);o&&this._setValueFromHexString(o)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const n=this._format.fromHexString(e);this.setValue(n)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Xe extends B{constructor(e,n,t){super(e,n,t,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",s=>{s.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class mi extends B{constructor(e,n,t,s,i,o){super(e,n,t,"number"),this._initInput(),this.min(s),this.max(i);const r=o!==void 0;this.step(r?o:this._getImplicitStep(),r),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,n=!0){return this._step=e,this._stepExplicit=n,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let n=(e-this._min)/(this._max-this._min);n=Math.max(0,Math.min(n,1)),this.$fill.style.width=100*n+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=h=>{const d=parseFloat(this.$input.value);isNaN(d)||(this._snapClampSetValue(d+h),this.$input.value=this.getValue())};let n,t,s,i,o,r=!1;const a=h=>{if(r){const d=h.clientX-n,p=h.clientY-t;Math.abs(p)>5?(h.preventDefault(),this.$input.blur(),r=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(d)>5&&l()}if(!r){const d=h.clientY-s;o-=d*this._step*this._arrowKeyMultiplier(h),i+o>this._max?o=this._max-i:i+o<this._min&&(o=this._min-i),this._snapClampSetValue(i+o)}s=h.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",()=>{let h=parseFloat(this.$input.value);isNaN(h)||(this._stepExplicit&&(h=this._snap(h)),this.setValue(this._clamp(h)))}),this.$input.addEventListener("keydown",h=>{h.code==="Enter"&&this.$input.blur(),h.code==="ArrowUp"&&(h.preventDefault(),e(this._step*this._arrowKeyMultiplier(h))),h.code==="ArrowDown"&&(h.preventDefault(),e(this._step*this._arrowKeyMultiplier(h)*-1))}),this.$input.addEventListener("wheel",h=>{this._inputFocused&&(h.preventDefault(),e(this._step*this._normalizeMouseWheel(h)))},{passive:!1}),this.$input.addEventListener("mousedown",h=>{n=h.clientX,t=s=h.clientY,r=!0,i=this.getValue(),o=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",l)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=p=>{const f=this.$slider.getBoundingClientRect();let m=(A=p,g=f.left,y=f.right,w=this._min,_=this._max,(A-g)/(y-g)*(_-w)+w);var A,g,y,w,_;this._snapClampSetValue(m)},n=p=>{e(p.clientX)},t=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",t)};let s,i,o=!1;const r=p=>{p.preventDefault(),this._setDraggingStyle(!0),e(p.touches[0].clientX),o=!1},a=p=>{if(o){const f=p.touches[0].clientX-s,m=p.touches[0].clientY-i;Math.abs(f)>Math.abs(m)?r(p):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",l))}else p.preventDefault(),e(p.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",l)},h=this._callOnFinishChange.bind(this);let d;this.$slider.addEventListener("mousedown",p=>{this._setDraggingStyle(!0),e(p.clientX),window.addEventListener("mousemove",n),window.addEventListener("mouseup",t)}),this.$slider.addEventListener("touchstart",p=>{p.touches.length>1||(this._hasScrollBar?(s=p.touches[0].clientX,i=p.touches[0].clientY,o=!0):r(p),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",l))},{passive:!1}),this.$slider.addEventListener("wheel",p=>{if(Math.abs(p.deltaX)<Math.abs(p.deltaY)&&this._hasScrollBar)return;p.preventDefault();const f=this._normalizeMouseWheel(p)*this._step;this._snapClampSetValue(this.getValue()+f),this.$input.value=this.getValue(),clearTimeout(d),d=setTimeout(h,400)},{passive:!1})}_setDraggingStyle(e,n="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle("lil-gui-"+n,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:n,deltaY:t}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(n=0,t=-e.wheelDelta/120,t*=this._stepExplicit?1:10),n+-t}_arrowKeyMultiplier(e){let n=this._stepExplicit?1:10;return e.shiftKey?n*=10:e.altKey&&(n/=10),n}_snap(e){const n=Math.round(e/this._step)*this._step;return parseFloat(n.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class gi extends B{constructor(e,n,t,s){super(e,n,t,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(s)?s:Object.values(s),this._names=Array.isArray(s)?s:Object.keys(s),this._names.forEach(i=>{const o=document.createElement("option");o.innerHTML=i,this.$select.appendChild(o)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),n=this._values.indexOf(e);return this.$select.selectedIndex=n,this.$display.innerHTML=n===-1?e:this._names[n],this}}class Ai extends B{constructor(e,n,t){super(e,n,t,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",s=>{s.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Ht=!1;class ot{constructor({parent:e,autoPlace:n=e===void 0,container:t,width:s,title:i="Controls",injectStyles:o=!0,touchStyles:r=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",a=>{a.code!=="Enter"&&a.code!=="Space"||(a.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(i),r&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Ht&&o&&(function(a){const l=document.createElement("style");l.innerHTML=a;const h=document.querySelector("head link[rel=stylesheet], head style");h?document.head.insertBefore(l,h):document.head.appendChild(l)}('.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:""}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}'),Ht=!0),t?t.appendChild(this.domElement):n&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this.domElement.addEventListener("keydown",a=>a.stopPropagation()),this.domElement.addEventListener("keyup",a=>a.stopPropagation())}add(e,n,t,s,i){if(Object(t)===t)return new gi(this,e,n,t);const o=e[n];switch(typeof o){case"number":return new mi(this,e,n,t,s,i);case"boolean":return new li(this,e,n);case"string":return new Ai(this,e,n);case"function":return new Xe(this,e,n)}console.error(`gui.add failed
	property:`,n,`
	object:`,e,`
	value:`,o)}addColor(e,n,t=1){return new fi(this,e,n,t)}addFolder(e){return new ot({parent:this,title:e})}load(e,n=!0){return e.controllers&&this.controllers.forEach(t=>{t instanceof Xe||t._name in e.controllers&&t.load(e.controllers[t._name])}),n&&e.folders&&this.folders.forEach(t=>{t._title in e.folders&&t.load(e.folders[t._title])}),this}save(e=!0){const n={controllers:{},folders:{}};return this.controllers.forEach(t=>{if(!(t instanceof Xe)){if(t._name in n.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);n.controllers[t._name]=t.save()}}),e&&this.folders.forEach(t=>{if(t._title in n.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);n.folders[t._title]=t.save()}),n}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const n=this.$children.clientHeight;this.$children.style.height=n+"px",this.domElement.classList.add("transition");const t=i=>{i.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",t))};this.$children.addEventListener("transitionend",t);const s=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=s+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(n=>n.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(n=>{e=e.concat(n.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(n=>{e=e.concat(n.foldersRecursive())}),e}}const C=new ot;C.hide();const F=new Jt(ri,ee().ratio,ai,ci),on={x:-280,y:-30,z:0},ke=(c,e,n,t)=>{for(const s in c)ce({from:e[s],to:c[s],onStep:i=>{e[s]=i,n&&n()},step:100,onComplete:t})},bi=()=>{ke(on,F.position),C.add(F.position,"x",-500,500),C.add(F.position,"y",-500,500),C.add(F.position,"z",-500,500),C.onChange(()=>F.updateProjectionMatrix())};bi();const yi=new ls(16777215,1),R=new Kt(13421772,10);R.position.set(2e3,2500,-1500);R.castShadow=!0;R.shadow.radius=1;R.shadow.mapSize.set(2048,2048);R.shadow.camera.near=.5;R.shadow.camera.far=5e3;R.shadow.camera.top=1e3;R.shadow.camera.bottom=-5e3;R.shadow.camera.left=-3e3;R.shadow.camera.right=1e3;const ae=new hs,wi=()=>{ae.add(yi),ae.add(R),C.add(R.shadow.camera,"near",0,10),C.add(R.shadow.camera,"far",0,5e3),C.add(R.shadow.camera,"left",-5e3,5e3),C.add(R.shadow.camera,"right",-5e3,5e3),C.add(R.shadow.camera,"top",-5e3,5e3),C.add(R.shadow.camera,"bottom",-5e3,5e3),C.add(R.shadow,"radius",-200,200),C.add(R.shadow.mapSize,"width",0,4096),C.add(R.shadow.mapSize,"height",0,4096),C.onChange(()=>{R.shadow.camera.updateProjectionMatrix()})},Te=new ds({antialias:!0});Te.shadowMap.enabled=!0;const Ti=()=>{const c=()=>{Te.render(ae,F),requestAnimationFrame(c)};c()},Ei=()=>{const c=()=>{const{width:e,height:n,ratio:t}=ee();Te.setSize(e,n),F.aspect=t,F.updateProjectionMatrix()};window.addEventListener("resize",c),c()},rn=Te.domElement,ve=new fs(F,rn),xi=()=>{document.body.append(rn)},an=c=>Te.setClearColor(c),_i=256,cn=(c,e)=>{ce({from:c,to:e,onStep:n=>an(Js(...Array(3).fill(Math.floor(n)))),step:_i})},Ri=(c=0,e=255)=>cn(c,e),Li=(c=255,e=0)=>cn(c,e),Ae=new G;Ae.position.set(-100,-120,0);const oe=new G;oe.position.set(-100,-120,0);const vi=new G,ln=(c,{rotation:e,scale:n,position:t})=>{c.scale.set(...n||[]),c.rotation.set(...(e||[]).map(s=>Math.PI/180*s)),c.position.set(...t||[])},rt=[{name:"bricks",scale:[100,100,100],position:[0,0,0],rotation:[0,0,0],filename:"rocks/rock_01"},{name:"door",scale:[60,90,80],rotation:[0,-90,0],position:[0,0,0],filename:"rocks/rock_02"},{name:"menhir_petit",scale:[30,15,25],rotation:[0,0,0],position:[0,0,0],filename:"rocks/rock_03"},{name:"coin",scale:[80,80,80],rotation:[0,0,0],position:[0,50,0],filename:"props/prop_01"}];rt.length;const Si=await sn(rt),Mi=async()=>{const c=new G;for(const[e,n]of Si.entries()){const t=await n;ln(t.children[0],rt[e]),c.add(t)}return c},Ci=await Mi(),ki=()=>{const c=ni(Ci);return c.traverse(e=>{e.isMesh&&(e.material=e.material.clone(),e.material.transparent=!0,e.castShadow=!0)}),c},Q=150,tt=5e3,be=5,Ii=368,Ee=await ii("road");Ee.wrapS=ye;Ee.wrapT=ye;Ee.repeat.set(1,tt/Ii);const Pi=c=>{const e=new G;for(let n=0;n<c;n++){const t=new Qt(new us(Q,tt),new st({side:qt,map:Ee})),s=(ee().width-c*Q)/2+Q/2,{x:i}=it(s+n*Q);t.position.z=i,t.rotateY(Math.PI/2),t.receiveShadow=!0,e.add(t)}return e.rotateZ(Math.PI/2),e.position.setX(tt/3),e},Oi=Pi(be),at=[{name:"car_01",scale:[70,70,70],rotation:[0,0,0],position:[0,0,0],filename:"cars/car_01"},{name:"car_02",scale:[35,35,30],rotation:[0,0,0],position:[0,0,0],filename:"cars/car_02"},{name:"car_03",scale:[65,65,65],rotation:[0,0,0],position:[0,0,0],filename:"cars/car_03"}];at.length;const Di=await sn(at),Ni=async()=>{const c=new G;for(const[e,n]of Di.entries()){const t=await n;ln(t,at[e]),c.add(t)}return c.traverse(e=>{e.castShadow!==void 0&&(e.castShadow=!0)}),c},Se=await Ni(),Fi=1e3/30,ji=1e3/15,Hi=1e3/5,Me=0,nt=1,Gt=2,Gi=2,Bi=.01;class Ui{state=Me;blocks=[];selectedCar=0;ready(e){requestAnimationFrame(()=>{O(()=>{this.interaction=new Ie(this),this.setCar(Se),this.setRoads(Oi),this.registerController(),e&&e()}),O.ready||this.ready(e)})}addBlock(e){this.blocks.push(e),oe.add(e.object)}removeBlock(e){const n=this.blocks.indexOf(e);this.blocks.splice(n,1),e.object.removeFromParent()}clearBlocks(){for(const e of this.blocks)e.offMove(),e.object.removeFromParent();this.blocks=[]}onGenerateBlock(){const e=()=>{const n=this.blocks.length,t=n?this.blocks.reduce((s,i)=>s+i.acceleration,0)/n:0;if(!this.interaction.isReducing){const s=new Vi;s.acceleration=t||s.acceleration,s.onMove(),this.addBlock(s),s.onDeprecated(()=>{s.offMove(),this.removeBlock(s)})}this.generateBlockTimer=setTimeout(e,Hi)};e()}offGenerateBlock(){clearInterval(this.generateBlockTimer)}setCar(e){this.car=new Ki(e.children[this.selectedCar].clone())}toggleCar(e){this.selectedCar+e===Se.children.length?this.selectedCar=0:this.selectedCar+e===-1?this.selectedCar=Se.children.length-1:this.selectedCar+=e,this.car.object.removeFromParent();const n=Se.children[this.selectedCar].clone();Ae.add(n),this.car.object=n}setRoads(e){this.roads=new le(e)}run(){this.state=Me,this.toggleCar(0),ae.add(Ae),this.car.fitCar(),this.interaction.openStartPage(),this.interaction.closeEndPage()}start(){this.state=nt,Ae.removeFromParent(),oe.add(this.car.object),oe.add(this.roads.object),ae.add(oe),this.car.registerController(),this.car.fitCar(),this.roads.reset(),this.roads.onMove(),this.onGenerateBlock(),this.onCheck(),this.interaction.closeStartPage(),this.interaction.openGamingPage()}stop(){this.state=Gt,oe.removeFromParent(),ae.add(vi),this.car.dismissController(),this.roads.offMove(),this.offGenerateBlock(),this.offCheck(),this.clearBlocks(),this.interaction.closeGamingPage(),this.interaction.openEndPage()}onCheck(){this.check=setInterval(()=>{e:for(let e=0;e<this.blocks.length;e++){const n=this.blocks[e];if(this.car.check(n)&&!n.checked){switch(n.object.userData.name){case"coin":this.interaction.collectCoin(n);break;default:this.stop();break e}n.checked=!0}}},Fi)}offCheck(){clearInterval(this.check)}registerController(){this.controller=({key:e,type:n})=>{switch(e){case" ":if(n==="keyup")switch(this.state){case Me:this.start();break;case nt:break;case Gt:this.run();break}break;case"ArrowLeft":case"ArrowRight":n==="keyup"&&this.state===Me&&(e==="ArrowLeft"?this.toggleCar(-1):this.toggleCar(1),this.car.fitCar());break;case"ArrowUp":case"ArrowDown":const t=e==="ArrowUp",s=n==="keydown";if(this.interaction.isReducing=!0,s)if(t){this.interaction.isReducing=!1;const i=this.roads.acceleration>=0;this.roads.acceleration*=i?1:-1,this.roads.updateSpeed(this.roads.acceleration);for(const o of this.blocks){const r=o.acceleration>=0;o.acceleration*=r?1:-1,o.updateSpeed(o.acceleration)}}else{const i=this.roads.acceleration>=0;this.roads.isRatioAcceleration||(this.roads.acceleration*=(i?-10:10)*D.animationRatio,this.roads.isRatioAcceleration=!0),this.roads.updateSpeed(this.roads.acceleration);for(const o of this.blocks){const r=o.acceleration>=0;o.isRatioAcceleration||(o.acceleration*=(r?-10:10)*D.animationRatio,o.isRatioAcceleration=!0),o.updateSpeed(o.acceleration)}}else{const i=this.roads.acceleration>=0;this.roads.acceleration*=i?-1:1,this.roads.updateSpeed(this.roads.acceleration);for(const o of this.blocks){const r=o.acceleration>=0;o.acceleration*=r?-1:1,o.updateSpeed(o.acceleration)}}this.roads.isRatioAcceleration&&(this.roads.acceleration/=10*D.animationRatio,this.roads.isRatioAcceleration=!1);for(const i of this.blocks)i.isRatioAcceleration&&(i.acceleration/=10*D.animationRatio,i.isRatioAcceleration=!1);break}},document.addEventListener("keydown",this.controller),document.addEventListener("keyup",this.controller)}dismissController(){document.removeEventListener("keydown",this.controller),document.removeEventListener("keyup",this.controller)}}class Ie{score=0;time=0;isReducing=!0;constructor(e){this.game=e,this.useOrbitControls()}flags={startPage:{carSelfRotate:!1}};doms={startPage:Ce("startPage"),gamingPage:Ce("gamingPage"),endPage:Ce("endPage"),score:Je(".score"),time:Je(".time")};bounce(e){e.classList.add("bounce"),e.onanimationend=()=>e.classList.remove("bounce")}collectCoin(e){e.offMove();const{offsetLeft:n,offsetTop:t}=this.doms.score[0];let{x:s,y:i}=it(n,t);s+=e.z;const o=()=>{this.html(this.doms.score,++this.score),this.bounce(this.doms.score[0]),e.object.removeFromParent()},r=[];e.object.traverse(f=>f.isMesh&&r.push(f.material));const a=[e.object.position,e.object.position,e.object.scale,e.object.scale,e.object.scale].concat(r),l=["y","z","x","y","z"].concat(Array(r.length).fill("opacity")),h=[i,s,0,0,0].concat(Array(r.length).fill(0));let[d,p]=[0,a.length];for(const[f,m]of a.entries()){const A=l[f]==="opacity",y=l[f]==="y"&&m===e.object.position||A?60:100;ce({from:m[l[f]],to:h[f],onStep:w=>m[l[f]]=w,onComplete:()=>{A&&(m.visible=!1),++d===p&&o()},step:y})}}html(e,n){if(n===void 0)return e.innerHTML;e.forEach(t=>t.innerHTML=n)}static moveView(e){ke({z:le.getVerticalCenterPosition(e)},F.position)}openStartPage(){this.flags.startPage.carSelfRotate=!1;const e=()=>{this.flags.startPage.carSelfRotate||requestAnimationFrame(()=>{Ae.rotateY(.003*D.animationRatio),e()})};e(),an(0),this.doms.startPage.style.opacity=1,this.html(this.doms.score,this.score=0),this.html(this.doms.time,`${this.time=0} seconds`)}closeStartPage(){this.flags.startPage.carSelfRotate=!0,this.doms.startPage.style.opacity=0}startTimer(){this.timer=setInterval(()=>{this.html(this.doms.time,`${++this.time} seconds`)},1e3)}stopTimer(){clearInterval(this.timer)}openGamingPage(){Ri(),this.startTimer()}closeGamingPage(){this.stopTimer()}openEndPage(){this.doms.endPage.style.opacity=1,Li()}closeEndPage(){this.doms.endPage.style.opacity=0}useOrbitControls(){ve.addEventListener("end",si(()=>{const e={z:le.getVerticalCenterPosition(this.game.car.roadIndex)};ke({...on,...this.game.state===nt?e:null},F.position,ve.update),ke({x:0,y:0,...e},ve.target,ve.update)},1e3))}}class hn{constructor(e){this._speed=e,this.acceleration=this.speed/10,this.max=e*2,this.min=e/2,this.canAccelerate(!0),this.canOverMax(!1),this.reset()}reset(){this.speed=this.min,this.acceleration*=this.acceleration>=0?-1:1}updateSpeed(e){this.speed+=e}overMin(){const e=this.speed<this.min;return e&&(this.speed=this.min),e}inRange(){return!this.overMin()&&!this.overMax()}overMax(){const e=this.speed>this.max;return e&&(this.speed=this.max),e}canAccelerate(e){this.accelerated=e}canOverMax(e){this.limited=!e}forward(e){this.moving=!0;const n=()=>{let t=this.accelerated?this.acceleration:0;this.moving&&(this.limited&&!this.inRange()&&(t=0),e&&e(this.speed),this.speed+=t,requestAnimationFrame(n))};n()}halt(){this.moving=!1}}const $i=5,zi=4;class Vi extends hn{x=0;z=0;checked=!1;constructor(e=Gi){super(e*D.animationRatio),this.object=ki(),this.decorate();const{height:n}=ee(),t=Qe(zi,$i);this.set(n*t,le.getVerticalCenterPosition(Qe(0,4))),this.max=this._speed*10,this.min=this._speed,this.acceleration=this._speed/200,this.reset()}decorate(){const e=this.object;if(e.userData.name==="coin"){const n=()=>{requestAnimationFrame(()=>{this.moving&&(e.rotateY(.05*D.animationRatio),n())})};n()}e.traverse(n=>{n.isMesh&&ce({from:0,to:1,onStep:t=>n.material.opacity=t,step:500})})}set(e,n){this.object.position.setX(e),this.object.position.setZ(n),this.x=e,this.z=n}onMove(){this.forward(e=>{this.set(this.x-e,this.z)})}offMove(){this.halt()}onDeprecated(e){this.deprecated=setInterval(()=>{this.x<0&&Math.abs(this.x)>ee().height&&(clearInterval(this.deprecated),e&&e())},ji)}}class Ki{roadIndex=Math.floor(be/2);check(e){const{position:{x:n,z:t},children:{0:{scale:{x:s,z:i}}}}=e.object,{position:{x:o,z:r},scale:{x:a,z:l}}=this.object,h=Math.abs(n-o)<=a/2+s/2,d=Math.abs(t-r)<=l/2+i/2;return h&&d}constructor(e){this.object=e.clone()}fitCar(){this.roadIndex=Math.floor(be/2),this.object.position.set(0,0,0),this.object.rotation.set(0,Math.PI/180*90,0),Ie.moveView(this.roadIndex)}toLeft(){this.roadIndex>0&&ce({from:this.object.position.z,to:le.getVerticalCenterPosition(--this.roadIndex),onStep:e=>this.object.position.setZ(e)})}toRight(){this.roadIndex<be-1&&ce({from:this.object.position.z,to:le.getVerticalCenterPosition(++this.roadIndex),onStep:e=>this.object.position.setZ(e)})}registerController(){this.control=({key:e})=>{switch(e){case"ArrowLeft":this.toLeft(),Ie.moveView(this.roadIndex);break;case"ArrowRight":this.toRight(),Ie.moveView(this.roadIndex);break}},document.addEventListener("keydown",this.control)}dismissController(){document.removeEventListener("keydown",this.control)}}class le extends hn{constructor(e,n=Bi){super(n*D.animationRatio),this.object=e,this.max=this._speed*3,this.acceleration=this._speed/500,this.reset()}static getVerticalCenterPosition(e){const n=(ee().width-be*Q)/2+Q/2,{x:t}=it(n+e*Q);return t}onMove(){this.forward(e=>{Ee.offset.y-=e})}offMove(){this.halt()}}Ei();Ti();xi();wi();const Bt=new Ui;Bt.ready(()=>Bt.run());
