import{E as kn,V as v,M as ie,T as oe,Q as Ce,S as Rt,a as P,R as In,P as Pn,b as $t,L as zt,F as ke,c as te,d as V,B as Vt,e as Ae,C as q,f as On,g as Ke,h as Kt,i as Xe,j as Dn,k as Nn,D as Xt,l as me,m as Q,n as Ie,I as Fn,o as jn,O as Yt,p as Wt,q as Hn,r as Bn,s as qt,t as Zt,u as Ye,v as Gn,w as He,x as Un,y as nt,z as Qt,A as $n,G as zn,H as Jt,J as Vn,K as Kn,N as Xn,U as Yn,W as j,X as en,Y as Wn,Z as qn,_ as Zn,$ as Qn,a0 as tn,a1 as vt,a2 as Jn,a3 as es,a4 as ts,a5 as ns,a6 as ss,a7 as is,a8 as os,a9 as rs,aa as as,ab as St,ac as Mt,ad as Ct,ae as kt,af as cs,ag as ls,ah as hs,ai as ds,aj as us,ak as st,al as ps,am as fs,an as ms,ao as gs,ap as As}from"./three-2233f894.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const It={type:"change"},Be={type:"start"},Pt={type:"end"},_e=new In,Ot=new Pn,bs=Math.cos(70*$t.DEG2RAD);class ys extends kn{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new v,this.cursor=new v,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ie.ROTATE,MIDDLE:ie.DOLLY,RIGHT:ie.PAN},this.touches={ONE:oe.ROTATE,TWO:oe.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(u){u.addEventListener("keydown",Fe),this._domElementKeyEvents=u},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Fe),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(It),t.update(),i=s.NONE},this.update=function(){const u=new v,b=new Ce().setFromUnitVectors(e.up,new v(0,1,0)),R=b.clone().invert(),M=new v,I=new Ce,se=new v,X=2*Math.PI;return function(Cn=null){const Lt=t.object.position;u.copy(Lt).sub(t.target),u.applyQuaternion(b),r.setFromVector3(u),t.autoRotate&&i===s.NONE&&he(B(Cn)),t.enableDamping?(r.theta+=a.theta*t.dampingFactor,r.phi+=a.phi*t.dampingFactor):(r.theta+=a.theta,r.phi+=a.phi);let U=t.minAzimuthAngle,$=t.maxAzimuthAngle;isFinite(U)&&isFinite($)&&(U<-Math.PI?U+=X:U>Math.PI&&(U-=X),$<-Math.PI?$+=X:$>Math.PI&&($-=X),U<=$?r.theta=Math.max(U,Math.min($,r.theta)):r.theta=r.theta>(U+$)/2?Math.max(U,r.theta):Math.min($,r.theta)),r.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,r.phi)),r.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(h,t.dampingFactor):t.target.add(h),t.target.sub(t.cursor),t.target.clampLength(t.minTargetRadius,t.maxTargetRadius),t.target.add(t.cursor),t.zoomToCursor&&k||t.object.isOrthographicCamera?r.radius=De(r.radius):r.radius=De(r.radius*c),u.setFromSpherical(r),u.applyQuaternion(R),Lt.copy(t.target).add(u),t.object.lookAt(t.target),t.enableDamping===!0?(a.theta*=1-t.dampingFactor,a.phi*=1-t.dampingFactor,h.multiplyScalar(1-t.dampingFactor)):(a.set(0,0,0),h.set(0,0,0));let Ee=!1;if(t.zoomToCursor&&k){let ue=null;if(t.object.isPerspectiveCamera){const pe=u.length();ue=De(pe*c);const xe=pe-ue;t.object.position.addScaledVector(E,xe),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const pe=new v(S.x,S.y,0);pe.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/c)),t.object.updateProjectionMatrix(),Ee=!0;const xe=new v(S.x,S.y,0);xe.unproject(t.object),t.object.position.sub(xe).add(pe),t.object.updateMatrixWorld(),ue=u.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;ue!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(ue).add(t.object.position):(_e.origin.copy(t.object.position),_e.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(_e.direction))<bs?e.lookAt(t.target):(Ot.setFromNormalAndCoplanarPoint(t.object.up,t.target),_e.intersectPlane(Ot,t.target))))}else t.object.isOrthographicCamera&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/c)),t.object.updateProjectionMatrix(),Ee=!0);return c=1,k=!1,Ee||M.distanceToSquared(t.object.position)>o||8*(1-I.dot(t.object.quaternion))>o||se.distanceToSquared(t.target)>0?(t.dispatchEvent(It),M.copy(t.object.position),I.copy(t.object.quaternion),se.copy(t.target),Ee=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",xt),t.domElement.removeEventListener("pointerdown",Tt),t.domElement.removeEventListener("pointercancel",de),t.domElement.removeEventListener("wheel",Et),t.domElement.removeEventListener("pointermove",Ne),t.domElement.removeEventListener("pointerup",de),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",Fe),t._domElementKeyEvents=null)};const t=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=s.NONE;const o=1e-6,r=new Rt,a=new Rt;let c=1;const h=new v,d=new P,p=new P,f=new P,m=new P,A=new P,g=new P,y=new P,w=new P,_=new P,E=new v,S=new P;let k=!1;const T=[],H={};function B(u){return u!==null?2*Math.PI/60*t.autoRotateSpeed*u:2*Math.PI/60/60*t.autoRotateSpeed}function K(){return Math.pow(.95,t.zoomSpeed)}function he(u){a.theta-=u}function Te(u){a.phi-=u}const lt=function(){const u=new v;return function(R,M){u.setFromMatrixColumn(M,0),u.multiplyScalar(-R),h.add(u)}}(),ht=function(){const u=new v;return function(R,M){t.screenSpacePanning===!0?u.setFromMatrixColumn(M,1):(u.setFromMatrixColumn(M,0),u.crossVectors(t.object.up,u)),u.multiplyScalar(R),h.add(u)}}(),ne=function(){const u=new v;return function(R,M){const I=t.domElement;if(t.object.isPerspectiveCamera){const se=t.object.position;u.copy(se).sub(t.target);let X=u.length();X*=Math.tan(t.object.fov/2*Math.PI/180),lt(2*R*X/I.clientHeight,t.object.matrix),ht(2*M*X/I.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(lt(R*(t.object.right-t.object.left)/t.object.zoom/I.clientWidth,t.object.matrix),ht(M*(t.object.top-t.object.bottom)/t.object.zoom/I.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function Oe(u){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?c/=u:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function dt(u){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?c*=u:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function ut(u){if(!t.zoomToCursor)return;k=!0;const b=t.domElement.getBoundingClientRect(),R=u.clientX-b.left,M=u.clientY-b.top,I=b.width,se=b.height;S.x=R/I*2-1,S.y=-(M/se)*2+1,E.set(S.x,S.y,1).unproject(t.object).sub(t.object.position).normalize()}function De(u){return Math.max(t.minDistance,Math.min(t.maxDistance,u))}function pt(u){d.set(u.clientX,u.clientY)}function fn(u){ut(u),y.set(u.clientX,u.clientY)}function ft(u){m.set(u.clientX,u.clientY)}function mn(u){p.set(u.clientX,u.clientY),f.subVectors(p,d).multiplyScalar(t.rotateSpeed);const b=t.domElement;he(2*Math.PI*f.x/b.clientHeight),Te(2*Math.PI*f.y/b.clientHeight),d.copy(p),t.update()}function gn(u){w.set(u.clientX,u.clientY),_.subVectors(w,y),_.y>0?Oe(K()):_.y<0&&dt(K()),y.copy(w),t.update()}function An(u){A.set(u.clientX,u.clientY),g.subVectors(A,m).multiplyScalar(t.panSpeed),ne(g.x,g.y),m.copy(A),t.update()}function bn(u){ut(u),u.deltaY<0?dt(K()):u.deltaY>0&&Oe(K()),t.update()}function yn(u){let b=!1;switch(u.code){case t.keys.UP:u.ctrlKey||u.metaKey||u.shiftKey?Te(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):ne(0,t.keyPanSpeed),b=!0;break;case t.keys.BOTTOM:u.ctrlKey||u.metaKey||u.shiftKey?Te(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):ne(0,-t.keyPanSpeed),b=!0;break;case t.keys.LEFT:u.ctrlKey||u.metaKey||u.shiftKey?he(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):ne(t.keyPanSpeed,0),b=!0;break;case t.keys.RIGHT:u.ctrlKey||u.metaKey||u.shiftKey?he(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):ne(-t.keyPanSpeed,0),b=!0;break}b&&(u.preventDefault(),t.update())}function mt(){if(T.length===1)d.set(T[0].pageX,T[0].pageY);else{const u=.5*(T[0].pageX+T[1].pageX),b=.5*(T[0].pageY+T[1].pageY);d.set(u,b)}}function gt(){if(T.length===1)m.set(T[0].pageX,T[0].pageY);else{const u=.5*(T[0].pageX+T[1].pageX),b=.5*(T[0].pageY+T[1].pageY);m.set(u,b)}}function At(){const u=T[0].pageX-T[1].pageX,b=T[0].pageY-T[1].pageY,R=Math.sqrt(u*u+b*b);y.set(0,R)}function wn(){t.enableZoom&&At(),t.enablePan&&gt()}function Tn(){t.enableZoom&&At(),t.enableRotate&&mt()}function bt(u){if(T.length==1)p.set(u.pageX,u.pageY);else{const R=je(u),M=.5*(u.pageX+R.x),I=.5*(u.pageY+R.y);p.set(M,I)}f.subVectors(p,d).multiplyScalar(t.rotateSpeed);const b=t.domElement;he(2*Math.PI*f.x/b.clientHeight),Te(2*Math.PI*f.y/b.clientHeight),d.copy(p)}function yt(u){if(T.length===1)A.set(u.pageX,u.pageY);else{const b=je(u),R=.5*(u.pageX+b.x),M=.5*(u.pageY+b.y);A.set(R,M)}g.subVectors(A,m).multiplyScalar(t.panSpeed),ne(g.x,g.y),m.copy(A)}function wt(u){const b=je(u),R=u.pageX-b.x,M=u.pageY-b.y,I=Math.sqrt(R*R+M*M);w.set(0,I),_.set(0,Math.pow(w.y/y.y,t.zoomSpeed)),Oe(_.y),y.copy(w)}function En(u){t.enableZoom&&wt(u),t.enablePan&&yt(u)}function xn(u){t.enableZoom&&wt(u),t.enableRotate&&bt(u)}function Tt(u){t.enabled!==!1&&(T.length===0&&(t.domElement.setPointerCapture(u.pointerId),t.domElement.addEventListener("pointermove",Ne),t.domElement.addEventListener("pointerup",de)),Sn(u),u.pointerType==="touch"?Rn(u):_n(u))}function Ne(u){t.enabled!==!1&&(u.pointerType==="touch"?vn(u):Ln(u))}function de(u){Mn(u),T.length===0&&(t.domElement.releasePointerCapture(u.pointerId),t.domElement.removeEventListener("pointermove",Ne),t.domElement.removeEventListener("pointerup",de)),t.dispatchEvent(Pt),i=s.NONE}function _n(u){let b;switch(u.button){case 0:b=t.mouseButtons.LEFT;break;case 1:b=t.mouseButtons.MIDDLE;break;case 2:b=t.mouseButtons.RIGHT;break;default:b=-1}switch(b){case ie.DOLLY:if(t.enableZoom===!1)return;fn(u),i=s.DOLLY;break;case ie.ROTATE:if(u.ctrlKey||u.metaKey||u.shiftKey){if(t.enablePan===!1)return;ft(u),i=s.PAN}else{if(t.enableRotate===!1)return;pt(u),i=s.ROTATE}break;case ie.PAN:if(u.ctrlKey||u.metaKey||u.shiftKey){if(t.enableRotate===!1)return;pt(u),i=s.ROTATE}else{if(t.enablePan===!1)return;ft(u),i=s.PAN}break;default:i=s.NONE}i!==s.NONE&&t.dispatchEvent(Be)}function Ln(u){switch(i){case s.ROTATE:if(t.enableRotate===!1)return;mn(u);break;case s.DOLLY:if(t.enableZoom===!1)return;gn(u);break;case s.PAN:if(t.enablePan===!1)return;An(u);break}}function Et(u){t.enabled===!1||t.enableZoom===!1||i!==s.NONE||(u.preventDefault(),t.dispatchEvent(Be),bn(u),t.dispatchEvent(Pt))}function Fe(u){t.enabled===!1||t.enablePan===!1||yn(u)}function Rn(u){switch(_t(u),T.length){case 1:switch(t.touches.ONE){case oe.ROTATE:if(t.enableRotate===!1)return;mt(),i=s.TOUCH_ROTATE;break;case oe.PAN:if(t.enablePan===!1)return;gt(),i=s.TOUCH_PAN;break;default:i=s.NONE}break;case 2:switch(t.touches.TWO){case oe.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;wn(),i=s.TOUCH_DOLLY_PAN;break;case oe.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Tn(),i=s.TOUCH_DOLLY_ROTATE;break;default:i=s.NONE}break;default:i=s.NONE}i!==s.NONE&&t.dispatchEvent(Be)}function vn(u){switch(_t(u),i){case s.TOUCH_ROTATE:if(t.enableRotate===!1)return;bt(u),t.update();break;case s.TOUCH_PAN:if(t.enablePan===!1)return;yt(u),t.update();break;case s.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;En(u),t.update();break;case s.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;xn(u),t.update();break;default:i=s.NONE}}function xt(u){t.enabled!==!1&&u.preventDefault()}function Sn(u){T.push(u)}function Mn(u){delete H[u.pointerId];for(let b=0;b<T.length;b++)if(T[b].pointerId==u.pointerId){T.splice(b,1);return}}function _t(u){let b=H[u.pointerId];b===void 0&&(b=new P,H[u.pointerId]=b),b.set(u.pageX,u.pageY)}function je(u){const b=u.pointerId===T[0].pointerId?T[1]:T[0];return H[b.pointerId]}t.domElement.addEventListener("contextmenu",xt),t.domElement.addEventListener("pointerdown",Tt),t.domElement.addEventListener("pointercancel",de),t.domElement.addEventListener("wheel",Et,{passive:!1}),this.update()}}const Ge=new WeakMap;class ws extends zt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,t,s){const i=new ke(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,o=>{this.parse(o,n,s)},t,s)}parse(e,n,t){this.decodeDracoFile(e,n,null,null,te).catch(t)}decodeDracoFile(e,n,t,s,i=V){const o={attributeIDs:t||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!t,vertexColorSpace:i};return this.decodeGeometry(e,o).then(n)}decodeGeometry(e,n){const t=JSON.stringify(n);if(Ge.has(e)){const a=Ge.get(e);if(a.key===t)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const i=this.workerNextTaskID++,o=e.byteLength,r=this._getWorker(i,o).then(a=>(s=a,new Promise((c,h)=>{s._callbacks[i]={resolve:c,reject:h},s.postMessage({type:"decode",id:i,taskConfig:n,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return r.catch(()=>!0).then(()=>{s&&i&&this._releaseTask(s,i)}),Ge.set(e,{key:t,promise:r}),r}_createGeometry(e){const n=new Vt;e.index&&n.setIndex(new Ae(e.index.array,1));for(let t=0;t<e.attributes.length;t++){const s=e.attributes[t],i=s.name,o=s.array,r=s.itemSize,a=new Ae(o,r);i==="color"&&(this._assignVertexColorSpace(a,s.vertexColorSpace),a.normalized=!(o instanceof Float32Array)),n.setAttribute(i,a)}return n}_assignVertexColorSpace(e,n){if(n!==te)return;const t=new q;for(let s=0,i=e.count;s<i;s++)t.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,t.r,t.g,t.b)}_loadLibrary(e,n){const t=new ke(this.manager);return t.setPath(this.decoderPath),t.setResponseType(n),t.setWithCredentials(this.withCredentials),new Promise((s,i)=>{t.load(e,s,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(t=>{const s=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=Ts.toString(),o=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(i){const o=i.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,i){return s._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskCosts[e]=n,t._taskLoad+=n,t})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Ts(){let l,e;onmessage=function(o){const r=o.data;switch(r.type){case"init":l=r.decoderConfig,e=new Promise(function(h){l.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(l)});break;case"decode":const a=r.buffer,c=r.taskConfig;e.then(h=>{const d=h.draco,p=new d.Decoder;try{const f=n(d,p,new Int8Array(a),c),m=f.attributes.map(A=>A.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:r.id,error:f.message})}finally{d.destroy(p)}});break}};function n(o,r,a,c){const h=c.attributeIDs,d=c.attributeTypes;let p,f;const m=r.GetEncodedGeometryType(a);if(m===o.TRIANGULAR_MESH)p=new o.Mesh,f=r.DecodeArrayToMesh(a,a.byteLength,p);else if(m===o.POINT_CLOUD)p=new o.PointCloud,f=r.DecodeArrayToPointCloud(a,a.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const A={index:null,attributes:[]};for(const g in h){const y=self[d[g]];let w,_;if(c.useUniqueIDs)_=h[g],w=r.GetAttributeByUniqueId(p,_);else{if(_=r.GetAttributeId(p,o[h[g]]),_===-1)continue;w=r.GetAttribute(p,_)}const E=s(o,r,p,g,y,w);g==="color"&&(E.vertexColorSpace=c.vertexColorSpace),A.attributes.push(E)}return m===o.TRIANGULAR_MESH&&(A.index=t(o,r,p)),o.destroy(p),A}function t(o,r,a){const h=a.num_faces()*3,d=h*4,p=o._malloc(d);r.GetTrianglesUInt32Array(a,d,p);const f=new Uint32Array(o.HEAPF32.buffer,p,h).slice();return o._free(p),{array:f,itemSize:1}}function s(o,r,a,c,h,d){const p=d.num_components(),m=a.num_points()*p,A=m*h.BYTES_PER_ELEMENT,g=i(o,h),y=o._malloc(A);r.GetAttributeDataArrayForAllPoints(a,d,g,A,y);const w=new h(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:c,array:w,itemSize:p}}function i(o,r){switch(r){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}function Dt(l,e){if(e===On)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===Ke||e===Kt){let n=l.getIndex();if(n===null){const o=[],r=l.getAttribute("position");if(r!==void 0){for(let a=0;a<r.count;a++)o.push(a);l.setIndex(o),n=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const t=n.count-2,s=[];if(e===Ke)for(let o=1;o<=t;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(let o=0;o<t;o++)o%2===0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=l.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}class Es extends zt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new vs(n)}),this.register(function(n){return new Ds(n)}),this.register(function(n){return new Ns(n)}),this.register(function(n){return new Fs(n)}),this.register(function(n){return new Ms(n)}),this.register(function(n){return new Cs(n)}),this.register(function(n){return new ks(n)}),this.register(function(n){return new Is(n)}),this.register(function(n){return new Rs(n)}),this.register(function(n){return new Ps(n)}),this.register(function(n){return new Ss(n)}),this.register(function(n){return new Os(n)}),this.register(function(n){return new _s(n)}),this.register(function(n){return new js(n)}),this.register(function(n){return new Hs(n)})}load(e,n,t,s){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=Xe.extractUrlBase(e),this.manager.itemStart(e);const r=function(c){s?s(c):console.error(c),i.manager.itemError(e),i.manager.itemEnd(e)},a=new ke(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{i.parse(c,o,function(h){n(h),i.manager.itemEnd(e)},r)}catch(h){r(h)}},t,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,s){let i;const o={},r={},a=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===nn){try{o[x.KHR_BINARY_GLTF]=new Bs(e)}catch(d){s&&s(d);return}i=JSON.parse(o[x.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Js(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,o[d.name]=!0}if(i.extensionsUsed)for(let h=0;h<i.extensionsUsed.length;++h){const d=i.extensionsUsed[h],p=i.extensionsRequired||[];switch(d){case x.KHR_MATERIALS_UNLIT:o[d]=new Ls;break;case x.KHR_DRACO_MESH_COMPRESSION:o[d]=new Gs(i,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:o[d]=new Us;break;case x.KHR_MESH_QUANTIZATION:o[d]=new $s;break;default:p.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(r),c.parse(t,s)}parseAsync(e,n){const t=this;return new Promise(function(s,i){t.parse(e,n,s,i)})}}function xs(){let l={};return{get:function(e){return l[e]},add:function(e,n){l[e]=n},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class _s{constructor(e){this.parser=e,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,s=n.length;t<s;t++){const i=n[t];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let s=n.cache.get(t);if(s)return s;const i=n.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let c;const h=new q(16777215);a.color!==void 0&&h.setRGB(a.color[0],a.color[1],a.color[2],V);const d=a.range!==void 0?a.range:0;switch(a.type){case"directional":c=new Xt(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Nn(h),c.distance=d;break;case"spot":c=new Dn(h),c.distance=d,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,c.angle=a.spot.outerConeAngle,c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return c.position.set(0,0,0),c.decay=2,W(c,a),a.intensity!==void 0&&(c.intensity=a.intensity),c.name=n.createUniqueName(a.name||"light_"+e),s=Promise.resolve(c),n.cache.add(t,s),s}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,i=t.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(a){return t._getNodeRef(n.cache,r,a)})}}class Ls{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return me}extendParams(e,n,t){const s=[];e.color=new q(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],V),e.opacity=o[3]}i.baseColorTexture!==void 0&&s.push(t.assignTexture(e,"map",i.baseColorTexture,te))}return Promise.all(s)}}class Rs{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class vs{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(n.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(t.assignTexture(n,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const r=o.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new P(r,r)}return Promise.all(i)}}class Ss{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(n.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(n.iridescenceIOR=o.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class Ms{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new q(0,0,0),n.sheenRoughness=0,n.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const r=o.sheenColorFactor;n.sheenColor.setRGB(r[0],r[1],r[2],V)}return o.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(t.assignTexture(n,"sheenColorMap",o.sheenColorTexture,te)),o.sheenRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class Cs{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(n.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(t.assignTexture(n,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class ks{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];n.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(t.assignTexture(n,"thicknessMap",o.thicknessTexture)),n.attenuationDistance=o.attenuationDistance||1/0;const r=o.attenuationColor||[1,1,1];return n.attenuationColor=new q().setRGB(r[0],r[1],r[2],V),Promise.all(i)}}class Is{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Ps{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];n.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(t.assignTexture(n,"specularIntensityMap",o.specularTexture));const r=o.specularColorFactor||[1,1,1];return n.specularColor=new q().setRGB(r[0],r[1],r[2],V),o.specularColorTexture!==void 0&&i.push(t.assignTexture(n,"specularColorMap",o.specularColorTexture,te)),Promise.all(i)}}class Os{constructor(e){this.parser=e,this.name=x.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:Q}extendMaterialParams(e,n){const t=this.parser,s=t.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(n.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(n.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(t.assignTexture(n,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class Ds{constructor(e){this.parser=e,this.name=x.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,s=t.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],o=n.options.ktx2Loader;if(!o){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,i.source,o)}}class Ns{constructor(e){this.parser=e,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[n])return null;const o=i.extensions[n],r=s.images[o.source];let a=t.textureLoader;if(r.uri){const c=t.options.manager.getHandler(r.uri);c!==null&&(a=c)}return this.detectSupport().then(function(c){if(c)return t.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Fs{constructor(e){this.parser=e,this.name=x.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[n])return null;const o=i.extensions[n],r=s.images[o.source];let a=t.textureLoader;if(r.uri){const c=t.options.manager.getHandler(r.uri);c!==null&&(a=c)}return this.detectSupport().then(function(c){if(c)return t.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class js{constructor(e){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const s=t.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(r){const a=s.byteOffset||0,c=s.byteLength||0,h=s.count,d=s.byteStride,p=new Uint8Array(r,a,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,p,s.mode,s.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(f),h,d,p,s.mode,s.filter),f})})}else return null}}class Hs{constructor(e){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const s=n.meshes[t.mesh];for(const c of s.primitives)if(c.mode!==D.TRIANGLES&&c.mode!==D.TRIANGLE_STRIP&&c.mode!==D.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=t.extensions[this.name].attributes,r=[],a={};for(const c in o)r.push(this.parser.getDependency("accessor",o[c]).then(h=>(a[c]=h,a[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],p=c[0].count,f=[];for(const m of d){const A=new Ie,g=new v,y=new Ce,w=new v(1,1,1),_=new Fn(m.geometry,m.material,p);for(let E=0;E<p;E++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,E),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,E),a.SCALE&&w.fromBufferAttribute(a.SCALE,E),_.setMatrixAt(E,A.compose(g,y,w));for(const E in a)if(E==="_COLOR_0"){const S=a[E];_.instanceColor=new jn(S.array,S.itemSize,S.normalized)}else E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&m.geometry.setAttribute(E,a[E]);Yt.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),f.push(_)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const nn="glTF",fe=12,Nt={JSON:1313821514,BIN:5130562};class Bs{constructor(e){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,fe),t=new TextDecoder;if(this.header={magic:t.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==nn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-fe,i=new DataView(e,fe);let o=0;for(;o<s;){const r=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,a===Nt.JSON){const c=new Uint8Array(e,fe+o,r);this.content=t.decode(c)}else if(a===Nt.BIN){const c=fe+o;this.body=e.slice(c,c+r)}o+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Gs{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,s=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,r={},a={},c={};for(const h in o){const d=We[h]||h.toLowerCase();r[d]=o[h]}for(const h in e.attributes){const d=We[h]||h.toLowerCase();if(o[h]!==void 0){const p=t.accessors[e.attributes[h]],f=re[p.componentType];c[d]=f.name,a[d]=p.normalized===!0}}return n.getDependency("bufferView",i).then(function(h){return new Promise(function(d){s.decodeDracoFile(h,function(p){for(const f in p.attributes){const m=p.attributes[f],A=a[f];A!==void 0&&(m.normalized=A)}d(p)},r,c)})})}}class Us{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class $s{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class sn extends hs{constructor(e,n,t,s){super(e,n,t,s)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,s=this.valueSize,i=e*s*3+s;for(let o=0;o!==s;o++)n[o]=t[i+o];return n}interpolate_(e,n,t,s){const i=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=r*2,c=r*3,h=s-n,d=(t-n)/h,p=d*d,f=p*d,m=e*c,A=m-c,g=-2*f+3*p,y=f-p,w=1-g,_=y-p+d;for(let E=0;E!==r;E++){const S=o[A+E+r],k=o[A+E+a]*h,T=o[m+E+r],H=o[m+E]*h;i[E]=w*S+_*k+g*T+y*H}return i}}const zs=new Ce;class Vs extends sn{interpolate_(e,n,t,s){const i=super.interpolate_(e,n,t,s);return zs.fromArray(i).normalize().toArray(i),i}}const D={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},re={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ft={9728:Jn,9729:qt,9984:es,9985:ts,9986:ns,9987:Zt},jt={33071:ss,33648:is,10497:Ye},Ue={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},We={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Y={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ks={CUBICSPLINE:void 0,LINEAR:tn,STEP:os},$e={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Xs(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new nt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:rs})),l.DefaultMaterial}function J(l,e,n){for(const t in n.extensions)l[t]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function W(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ys(l,e,n){let t=!1,s=!1,i=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(t=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(i=!0),t&&s&&i)break}if(!t&&!s&&!i)return Promise.resolve(l);const o=[],r=[],a=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(t){const p=d.POSITION!==void 0?n.getDependency("accessor",d.POSITION):l.attributes.position;o.push(p)}if(s){const p=d.NORMAL!==void 0?n.getDependency("accessor",d.NORMAL):l.attributes.normal;r.push(p)}if(i){const p=d.COLOR_0!==void 0?n.getDependency("accessor",d.COLOR_0):l.attributes.color;a.push(p)}}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(a)]).then(function(c){const h=c[0],d=c[1],p=c[2];return t&&(l.morphAttributes.position=h),s&&(l.morphAttributes.normal=d),i&&(l.morphAttributes.color=p),l.morphTargetsRelative=!0,l})}function Ws(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let n=0,t=e.weights.length;n<t;n++)l.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(l.morphTargetInfluences.length===n.length){l.morphTargetDictionary={};for(let t=0,s=n.length;t<s;t++)l.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function qs(l){let e;const n=l.extensions&&l.extensions[x.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+ze(n.attributes):e=l.indices+":"+ze(l.attributes)+":"+l.mode,l.targets!==void 0)for(let t=0,s=l.targets.length;t<s;t++)e+=":"+ze(l.targets[t]);return e}function ze(l){let e="";const n=Object.keys(l).sort();for(let t=0,s=n.length;t<s;t++)e+=n[t]+":"+l[n[t]]+";";return e}function qe(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Zs(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Qs=new Ie;class Js{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new xs,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,s=!1,i=-1;typeof navigator<"u"&&(t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,i=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||t||s&&i<98?this.textureLoader=new Wt(this.options.manager):this.textureLoader=new Hn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ke(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(o){const r={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:t,userData:{}};return J(i,r,s),W(r,s),Promise.all(t._invokeAll(function(a){return a.afterRoot&&a.afterRoot(r)})).then(function(){e(r)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let s=0,i=n.length;s<i;s++){const o=n[s].joints;for(let r=0,a=o.length;r<a;r++)e[o[r]].isBone=!0}for(let s=0,i=e.length;s<i;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(t[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const s=t.clone(),i=(o,r)=>{const a=this.associations.get(o);a!=null&&this.associations.set(r,a);for(const[c,h]of o.children.entries())i(h,r.children[c])};return i(t,s),s.name+="_instance_"+e.uses[n]++,s}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const s=e(n[t]);if(s)return s}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let s=0;s<n.length;s++){const i=e(n[s]);i&&t.push(i)}return t}getDependency(e,n){const t=e+":"+n;let s=this.cache.get(t);if(!s){switch(e){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,n)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(t,s)}return s}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(i,o){return t.getDependency(e,o)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,o){t.load(Xe.resolveURL(n.uri,s.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const s=n.byteLength||0,i=n.byteOffset||0;return t.slice(i,i+s)})}loadAccessor(e){const n=this,t=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Ue[s.type],r=re[s.componentType],a=s.normalized===!0,c=new r(s.count*o);return Promise.resolve(new Ae(c,o,a))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(o){const r=o[0],a=Ue[s.type],c=re[s.componentType],h=c.BYTES_PER_ELEMENT,d=h*a,p=s.byteOffset||0,f=s.bufferView!==void 0?t.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let A,g;if(f&&f!==d){const y=Math.floor(p/f),w="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=n.cache.get(w);_||(A=new c(r,y*f,s.count*f/h),_=new Bn(A,f/h),n.cache.add(w,_)),g=new as(_,a,p%f/h,m)}else r===null?A=new c(s.count*a):A=new c(r,p,s.count*a),g=new Ae(A,a,m);if(s.sparse!==void 0){const y=Ue.SCALAR,w=re[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,E=s.sparse.values.byteOffset||0,S=new w(o[1],_,s.sparse.count*y),k=new c(o[2],E,s.sparse.count*a);r!==null&&(g=new Ae(g.array.slice(),g.itemSize,g.normalized));for(let T=0,H=S.length;T<H;T++){const B=S[T];if(g.setX(B,k[T*a]),a>=2&&g.setY(B,k[T*a+1]),a>=3&&g.setZ(B,k[T*a+2]),a>=4&&g.setW(B,k[T*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const n=this.json,t=this.options,i=n.textures[e].source,o=n.images[i];let r=this.textureLoader;if(o.uri){const a=t.manager.getHandler(o.uri);a!==null&&(r=a)}return this.loadTextureImage(e,i,r)}loadTextureImage(e,n,t){const s=this,i=this.json,o=i.textures[e],r=i.images[n],a=(r.uri||r.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const c=this.loadImageSource(n,t).then(function(h){h.flipY=!1,h.name=o.name||r.name||"",h.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(h.name=r.uri);const p=(i.samplers||{})[o.sampler]||{};return h.magFilter=Ft[p.magFilter]||qt,h.minFilter=Ft[p.minFilter]||Zt,h.wrapS=jt[p.wrapS]||Ye,h.wrapT=jt[p.wrapT]||Ye,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[a]=c,c}loadImageSource(e,n){const t=this,s=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=s.images[e],r=self.URL||self.webkitURL;let a=o.uri||"",c=!1;if(o.bufferView!==void 0)a=t.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const p=new Blob([d],{type:o.mimeType});return a=r.createObjectURL(p),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then(function(d){return new Promise(function(p,f){let m=p;n.isImageBitmapLoader===!0&&(m=function(A){const g=new St(A);g.needsUpdate=!0,p(g)}),n.load(Xe.resolveURL(d,i.path),m,void 0,f)})}).then(function(d){return c===!0&&r.revokeObjectURL(a),d.userData.mimeType=o.mimeType||Zs(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),d});return this.sourceCache[e]=h,h}assignTexture(e,n,t,s){const i=this;return this.getDependency("texture",t.index).then(function(o){if(!o)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(o=o.clone(),o.channel=t.texCoord),i.extensions[x.KHR_TEXTURE_TRANSFORM]){const r=t.extensions!==void 0?t.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const a=i.associations.get(o);o=i.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(o,r),i.associations.set(o,a)}}return s!==void 0&&(o.colorSpace=s),e[n]=o,o})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const s=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,o=n.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+t.uuid;let a=this.cache.get(r);a||(a=new Gn,He.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,a.sizeAttenuation=!1,this.cache.add(r,a)),t=a}else if(e.isLine){const r="LineBasicMaterial:"+t.uuid;let a=this.cache.get(r);a||(a=new Un,He.prototype.copy.call(a,t),a.color.copy(t.color),a.map=t.map,this.cache.add(r,a)),t=a}if(s||i||o){let r="ClonedMaterial:"+t.uuid+":";s&&(r+="derivative-tangents:"),i&&(r+="vertex-colors:"),o&&(r+="flat-shading:");let a=this.cache.get(r);a||(a=t.clone(),i&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(r,a),this.associations.set(a,this.associations.get(t))),t=a}e.material=t}getMaterialType(){return nt}loadMaterial(e){const n=this,t=this.json,s=this.extensions,i=t.materials[e];let o;const r={},a=i.extensions||{},c=[];if(a[x.KHR_MATERIALS_UNLIT]){const d=s[x.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(r,i,n))}else{const d=i.pbrMetallicRoughness||{};if(r.color=new q(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;r.color.setRGB(p[0],p[1],p[2],V),r.opacity=p[3]}d.baseColorTexture!==void 0&&c.push(n.assignTexture(r,"map",d.baseColorTexture,te)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(n.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,r)})))}i.doubleSided===!0&&(r.side=Qt);const h=i.alphaMode||$e.OPAQUE;if(h===$e.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,h===$e.MASK&&(r.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==me&&(c.push(n.assignTexture(r,"normalMap",i.normalTexture)),r.normalScale=new P(1,1),i.normalTexture.scale!==void 0)){const d=i.normalTexture.scale;r.normalScale.set(d,d)}if(i.occlusionTexture!==void 0&&o!==me&&(c.push(n.assignTexture(r,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==me){const d=i.emissiveFactor;r.emissive=new q().setRGB(d[0],d[1],d[2],V)}return i.emissiveTexture!==void 0&&o!==me&&c.push(n.assignTexture(r,"emissiveMap",i.emissiveTexture,te)),Promise.all(c).then(function(){const d=new o(r);return i.name&&(d.name=i.name),W(d,i),n.associations.set(d,{materials:e}),i.extensions&&J(s,d,i),d})}createUniqueName(e){const n=$n.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,t=this.extensions,s=this.primitiveCache;function i(r){return t[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,n).then(function(a){return Ht(a,r,n)})}const o=[];for(let r=0,a=e.length;r<a;r++){const c=e[r],h=qs(c),d=s[h];if(d)o.push(d.promise);else{let p;c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION]?p=i(c):p=Ht(new Vt,c,n),s[h]={primitive:c,promise:p},o.push(p)}}return Promise.all(o)}loadMesh(e){const n=this,t=this.json,s=this.extensions,i=t.meshes[e],o=i.primitives,r=[];for(let a=0,c=o.length;a<c;a++){const h=o[a].material===void 0?Xs(this.cache):this.getDependency("material",o[a].material);r.push(h)}return r.push(n.loadGeometries(o)),Promise.all(r).then(function(a){const c=a.slice(0,a.length-1),h=a[a.length-1],d=[];for(let f=0,m=h.length;f<m;f++){const A=h[f],g=o[f];let y;const w=c[f];if(g.mode===D.TRIANGLES||g.mode===D.TRIANGLE_STRIP||g.mode===D.TRIANGLE_FAN||g.mode===void 0)y=i.isSkinnedMesh===!0?new zn(A,w):new Jt(A,w),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),g.mode===D.TRIANGLE_STRIP?y.geometry=Dt(y.geometry,Kt):g.mode===D.TRIANGLE_FAN&&(y.geometry=Dt(y.geometry,Ke));else if(g.mode===D.LINES)y=new Vn(A,w);else if(g.mode===D.LINE_STRIP)y=new Kn(A,w);else if(g.mode===D.LINE_LOOP)y=new Xn(A,w);else if(g.mode===D.POINTS)y=new Yn(A,w);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(y.geometry.morphAttributes).length>0&&Ws(y,i),y.name=n.createUniqueName(i.name||"mesh_"+e),W(y,i),g.extensions&&J(s,y,g),n.assignFinalMaterial(y),d.push(y)}for(let f=0,m=d.length;f<m;f++)n.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return i.extensions&&J(s,d[0],i),d[0];const p=new j;i.extensions&&J(s,p,i),n.associations.set(p,{meshes:e});for(let f=0,m=d.length;f<m;f++)p.add(d[f]);return p})}loadCamera(e){let n;const t=this.json.cameras[e],s=t[t.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?n=new en($t.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):t.type==="orthographic"&&(n=new Wn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),W(n,t),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],t=[];for(let s=0,i=n.joints.length;s<i;s++)t.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",n.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(s){const i=s.pop(),o=s,r=[],a=[];for(let c=0,h=o.length;c<h;c++){const d=o[c];if(d){r.push(d);const p=new Ie;i!==null&&p.fromArray(i.array,c*16),a.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[c])}return new qn(r,a)})}loadAnimation(e){const n=this.json,t=this,s=n.animations[e],i=s.name?s.name:"animation_"+e,o=[],r=[],a=[],c=[],h=[];for(let d=0,p=s.channels.length;d<p;d++){const f=s.channels[d],m=s.samplers[f.sampler],A=f.target,g=A.node,y=s.parameters!==void 0?s.parameters[m.input]:m.input,w=s.parameters!==void 0?s.parameters[m.output]:m.output;A.node!==void 0&&(o.push(this.getDependency("node",g)),r.push(this.getDependency("accessor",y)),a.push(this.getDependency("accessor",w)),c.push(m),h.push(A))}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(a),Promise.all(c),Promise.all(h)]).then(function(d){const p=d[0],f=d[1],m=d[2],A=d[3],g=d[4],y=[];for(let w=0,_=p.length;w<_;w++){const E=p[w],S=f[w],k=m[w],T=A[w],H=g[w];if(E===void 0)continue;E.updateMatrix&&E.updateMatrix();const B=t._createAnimationTracks(E,S,k,T,H);if(B)for(let K=0;K<B.length;K++)y.push(B[K])}return new Zn(i,void 0,y)})}createNodeMesh(e){const n=this.json,t=this,s=n.nodes[e];return s.mesh===void 0?null:t.getDependency("mesh",s.mesh).then(function(i){const o=t._getNodeRef(t.meshCache,s.mesh,i);return s.weights!==void 0&&o.traverse(function(r){if(r.isMesh)for(let a=0,c=s.weights.length;a<c;a++)r.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const n=this.json,t=this,s=n.nodes[e],i=t._loadNodeShallow(e),o=[],r=s.children||[];for(let c=0,h=r.length;c<h;c++)o.push(t.getDependency("node",r[c]));const a=s.skin===void 0?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([i,Promise.all(o),a]).then(function(c){const h=c[0],d=c[1],p=c[2];p!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(p,Qs)});for(let f=0,m=d.length;f<m;f++)h.add(d[f]);return h})}_loadNodeShallow(e){const n=this.json,t=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=n.nodes[e],o=i.name?s.createUniqueName(i.name):"",r=[],a=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return a&&r.push(a),i.camera!==void 0&&r.push(s.getDependency("camera",i.camera).then(function(c){return s._getNodeRef(s.cameraCache,i.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),this.nodeCache[e]=Promise.all(r).then(function(c){let h;if(i.isBone===!0?h=new Qn:c.length>1?h=new j:c.length===1?h=c[0]:h=new Yt,h!==c[0])for(let d=0,p=c.length;d<p;d++)h.add(c[d]);if(i.name&&(h.userData.name=i.name,h.name=o),W(h,i),i.extensions&&J(t,h,i),i.matrix!==void 0){const d=new Ie;d.fromArray(i.matrix),h.applyMatrix4(d)}else i.translation!==void 0&&h.position.fromArray(i.translation),i.rotation!==void 0&&h.quaternion.fromArray(i.rotation),i.scale!==void 0&&h.scale.fromArray(i.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],s=this,i=new j;t.name&&(i.name=s.createUniqueName(t.name)),W(i,t),t.extensions&&J(n,i,t);const o=t.nodes||[],r=[];for(let a=0,c=o.length;a<c;a++)r.push(s.getDependency("node",o[a]));return Promise.all(r).then(function(a){for(let h=0,d=a.length;h<d;h++)i.add(a[h]);const c=h=>{const d=new Map;for(const[p,f]of s.associations)(p instanceof He||p instanceof St)&&d.set(p,f);return h.traverse(p=>{const f=s.associations.get(p);f!=null&&d.set(p,f)}),d};return s.associations=c(i),i})}_createAnimationTracks(e,n,t,s,i){const o=[],r=e.name?e.name:e.uuid,a=[];Y[i.path]===Y.weights?e.traverse(function(p){p.morphTargetInfluences&&a.push(p.name?p.name:p.uuid)}):a.push(r);let c;switch(Y[i.path]){case Y.weights:c=Ct;break;case Y.rotation:c=kt;break;case Y.position:case Y.scale:c=Mt;break;default:switch(t.itemSize){case 1:c=Ct;break;case 2:case 3:default:c=Mt;break}break}const h=s.interpolation!==void 0?Ks[s.interpolation]:tn,d=this._getArrayFromAccessor(t);for(let p=0,f=a.length;p<f;p++){const m=new c(a[p]+"."+Y[i.path],n.array,d,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const t=qe(n.constructor),s=new Float32Array(n.length);for(let i=0,o=n.length;i<o;i++)s[i]=n[i]*t;n=s}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const s=this instanceof kt?Vs:sn;return new s(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ei(l,e,n){const t=e.attributes,s=new cs;if(t.POSITION!==void 0){const r=n.json.accessors[t.POSITION],a=r.min,c=r.max;if(a!==void 0&&c!==void 0){if(s.set(new v(a[0],a[1],a[2]),new v(c[0],c[1],c[2])),r.normalized){const h=qe(re[r.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const r=new v,a=new v;for(let c=0,h=i.length;c<h;c++){const d=i[c];if(d.POSITION!==void 0){const p=n.json.accessors[d.POSITION],f=p.min,m=p.max;if(f!==void 0&&m!==void 0){if(a.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),a.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),a.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),p.normalized){const A=qe(re[p.componentType]);a.multiplyScalar(A)}r.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(r)}l.boundingBox=s;const o=new ls;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,l.boundingSphere=o}function Ht(l,e,n){const t=e.attributes,s=[];function i(o,r){return n.getDependency("accessor",o).then(function(a){l.setAttribute(r,a)})}for(const o in t){const r=We[o]||o.toLowerCase();r in l.attributes||s.push(i(t[o],r))}if(e.indices!==void 0&&!l.index){const o=n.getDependency("accessor",e.indices).then(function(r){l.setIndex(r)});s.push(o)}return vt.workingColorSpace!==V&&"COLOR_0"in t&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${vt.workingColorSpace}" not supported.`),W(l,e),ei(l,e,n),Promise.all(s).then(function(){return e.targets!==void 0?Ys(l,e.targets,n):l})}const Z=()=>{const l=window.innerWidth,e=window.innerHeight,n=l/e;return{width:l,height:e,ratio:n}},ti=(l,e)=>{const{loaded:n,total:t}=l;let s=document.getElementById("tempMask");s||(s=document.createElement("div"),s.style.position="absolute",s.style.inset="0",s.style.zIndex="10",s.style.color="orange",s.style.backgroundColor="rgba(255, 255, 255, .5)",s.id="tempMask",s.innerHTML="正在加载相关模型资源");let i=document.getElementById("pid:"+e);i||(i=document.createElement("p"),i.innerHTML=`正在加载位于 [${e}] 的模型资源<br>加载进度：`,i.id="pid:"+e);let o=document.getElementById("progressid:"+e);o||(o=document.createElement("progress"),o.max=t,o.id="progressid:"+e),i.appendChild(o),s.appendChild(i),document.body.appendChild(s),o.value=n},ni=()=>{Qe("progress").length>=7&&document.body.removeChild(ge("tempMask"))},si=(l,e=!0)=>{const n=new Es;if(e){const t=new ws;t.setDecoderPath("./draco/"),n.setDRACOLoader(t)}return new Promise((t,s)=>{n.load(l,i=>{t(i),ni()},i=>ti(i,l),s)})},Ze=(l,e)=>Math.floor(Math.floor((e-l+1)*Math.random())+l),it=(l,e)=>{const{width:n,height:t}=Z();return{x:n/2-(n-l),y:(t/2-(t-e))*-1}},ce=({from:l,to:e,onStep:n,onComplete:t,step:s=50})=>{const i=100*z.animationRatio;e*=i,l*=i;const o=(e-l)/s*z.animationRatio,r=()=>{l=parseFloat(l.toFixed(2)),e=parseFloat(e.toFixed(2)),l===e?t&&t(e,l):l!==e&&(l+=o,Math.abs(l-e)<Math.abs(o)&&(l=e),n&&n(l/i),requestAnimationFrame(r))};r()},ii=l=>`/race-game/resource/${l}.gltf`,oi=async l=>{const{filename:e}=l,n=new URL(ii(e),location.href).href,t=new j;return t.add((await si(n,!0)).scene),t.userData=l,t},on=async l=>l.map(async e=>await oi(e)),ri=l=>l.children[Ze(0,l.children.length-1)].clone(),ge=l=>document.getElementById(l),Qe=l=>document.querySelectorAll(l),ai=(l,e=300)=>{let n;return()=>{clearTimeout(n),n=setTimeout(l,e)}},rn=async l=>new Promise((e,n)=>new Wt().load(`/race-game/resource/textures/${l}.png`,e,null,n)),ci=new ds,z={fps:60,fpsRatio:2.4,animationRatio:2.4};let O=l=>{if(!O.ready)if(O.checkFpsTimes++<O.checkFpsThreshold){let e=1/(ci.getDelta()||1);e=e>144?144:e,e=e<60?60:e,O.avgFps+=e}else{let e=O.avgFps/O.checkFpsThreshold;e=[60,75,90,120,144].find(t=>e>t-15&&e<t+15);const n=144/e;z.fps=e,z.fpsRatio=n,z.animationRatio=n,O.ready=!0,l&&l()}};O.checkFpsThreshold=60;O.checkFpsTimes=0;O.avgFps=0;O.ready=!1;const li=100,hi=1,di=5e3;/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class G{constructor(e,n,t,s,i="div"){this.parent=e,this.object=n,this.property=t,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),G.nextNameID=G.nextNameID||0,this.$name.id="lil-gui-name-"+ ++G.nextNameID,this.$widget=document.createElement(i),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(t)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const n=this.parent.add(this.object,this.property,e);return n.name(this._name),this.destroy(),n}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class ui extends G{constructor(e,n,t){super(e,n,t,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Je(l){let e,n;return(e=l.match(/(#|0x)?([a-f0-9]{6})/i))?n=e[2]:(e=l.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?n=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=l.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!n&&"#"+n}const pi={isPrimitive:!0,match:l=>typeof l=="string",fromHexString:Je,toHexString:Je},we={isPrimitive:!0,match:l=>typeof l=="number",fromHexString:l=>parseInt(l.substring(1),16),toHexString:l=>"#"+l.toString(16).padStart(6,0)},fi={isPrimitive:!1,match:Array.isArray,fromHexString(l,e,n=1){const t=we.fromHexString(l);e[0]=(t>>16&255)/255*n,e[1]=(t>>8&255)/255*n,e[2]=(255&t)/255*n},toHexString:([l,e,n],t=1)=>we.toHexString(l*(t=255/t)<<16^e*t<<8^n*t<<0)},mi={isPrimitive:!1,match:l=>Object(l)===l,fromHexString(l,e,n=1){const t=we.fromHexString(l);e.r=(t>>16&255)/255*n,e.g=(t>>8&255)/255*n,e.b=(255&t)/255*n},toHexString:({r:l,g:e,b:n},t=1)=>we.toHexString(l*(t=255/t)<<16^e*t<<8^n*t<<0)},gi=[pi,we,fi,mi];class Ai extends G{constructor(e,n,t,s){var i;super(e,n,t,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(i=this.initialValue,gi.find(o=>o.match(i))),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const o=Je(this.$text.value);o&&this._setValueFromHexString(o)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const n=this._format.fromHexString(e);this.setValue(n)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Ve extends G{constructor(e,n,t){super(e,n,t,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",s=>{s.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class bi extends G{constructor(e,n,t,s,i,o){super(e,n,t,"number"),this._initInput(),this.min(s),this.max(i);const r=o!==void 0;this.step(r?o:this._getImplicitStep(),r),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,n=!0){return this._step=e,this._stepExplicit=n,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let n=(e-this._min)/(this._max-this._min);n=Math.max(0,Math.min(n,1)),this.$fill.style.width=100*n+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=h=>{const d=parseFloat(this.$input.value);isNaN(d)||(this._snapClampSetValue(d+h),this.$input.value=this.getValue())};let n,t,s,i,o,r=!1;const a=h=>{if(r){const d=h.clientX-n,p=h.clientY-t;Math.abs(p)>5?(h.preventDefault(),this.$input.blur(),r=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(d)>5&&c()}if(!r){const d=h.clientY-s;o-=d*this._step*this._arrowKeyMultiplier(h),i+o>this._max?o=this._max-i:i+o<this._min&&(o=this._min-i),this._snapClampSetValue(i+o)}s=h.clientY},c=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",c)};this.$input.addEventListener("input",()=>{let h=parseFloat(this.$input.value);isNaN(h)||(this._stepExplicit&&(h=this._snap(h)),this.setValue(this._clamp(h)))}),this.$input.addEventListener("keydown",h=>{h.code==="Enter"&&this.$input.blur(),h.code==="ArrowUp"&&(h.preventDefault(),e(this._step*this._arrowKeyMultiplier(h))),h.code==="ArrowDown"&&(h.preventDefault(),e(this._step*this._arrowKeyMultiplier(h)*-1))}),this.$input.addEventListener("wheel",h=>{this._inputFocused&&(h.preventDefault(),e(this._step*this._normalizeMouseWheel(h)))},{passive:!1}),this.$input.addEventListener("mousedown",h=>{n=h.clientX,t=s=h.clientY,r=!0,i=this.getValue(),o=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",c)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=p=>{const f=this.$slider.getBoundingClientRect();let m=(A=p,g=f.left,y=f.right,w=this._min,_=this._max,(A-g)/(y-g)*(_-w)+w);var A,g,y,w,_;this._snapClampSetValue(m)},n=p=>{e(p.clientX)},t=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",t)};let s,i,o=!1;const r=p=>{p.preventDefault(),this._setDraggingStyle(!0),e(p.touches[0].clientX),o=!1},a=p=>{if(o){const f=p.touches[0].clientX-s,m=p.touches[0].clientY-i;Math.abs(f)>Math.abs(m)?r(p):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",c))}else p.preventDefault(),e(p.touches[0].clientX)},c=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",c)},h=this._callOnFinishChange.bind(this);let d;this.$slider.addEventListener("mousedown",p=>{this._setDraggingStyle(!0),e(p.clientX),window.addEventListener("mousemove",n),window.addEventListener("mouseup",t)}),this.$slider.addEventListener("touchstart",p=>{p.touches.length>1||(this._hasScrollBar?(s=p.touches[0].clientX,i=p.touches[0].clientY,o=!0):r(p),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",c))},{passive:!1}),this.$slider.addEventListener("wheel",p=>{if(Math.abs(p.deltaX)<Math.abs(p.deltaY)&&this._hasScrollBar)return;p.preventDefault();const f=this._normalizeMouseWheel(p)*this._step;this._snapClampSetValue(this.getValue()+f),this.$input.value=this.getValue(),clearTimeout(d),d=setTimeout(h,400)},{passive:!1})}_setDraggingStyle(e,n="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle("lil-gui-"+n,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:n,deltaY:t}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(n=0,t=-e.wheelDelta/120,t*=this._stepExplicit?1:10),n+-t}_arrowKeyMultiplier(e){let n=this._stepExplicit?1:10;return e.shiftKey?n*=10:e.altKey&&(n/=10),n}_snap(e){const n=Math.round(e/this._step)*this._step;return parseFloat(n.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class yi extends G{constructor(e,n,t,s){super(e,n,t,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(s)?s:Object.values(s),this._names=Array.isArray(s)?s:Object.keys(s),this._names.forEach(i=>{const o=document.createElement("option");o.innerHTML=i,this.$select.appendChild(o)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),n=this._values.indexOf(e);return this.$select.selectedIndex=n,this.$display.innerHTML=n===-1?e:this._names[n],this}}class wi extends G{constructor(e,n,t){super(e,n,t,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",s=>{s.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Bt=!1;class ot{constructor({parent:e,autoPlace:n=e===void 0,container:t,width:s,title:i="Controls",injectStyles:o=!0,touchStyles:r=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",a=>{a.code!=="Enter"&&a.code!=="Space"||(a.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(i),r&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Bt&&o&&(function(a){const c=document.createElement("style");c.innerHTML=a;const h=document.querySelector("head link[rel=stylesheet], head style");h?document.head.insertBefore(c,h):document.head.appendChild(c)}('.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"↕";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"▾";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:"▸"}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"✓";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}'),Bt=!0),t?t.appendChild(this.domElement):n&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this.domElement.addEventListener("keydown",a=>a.stopPropagation()),this.domElement.addEventListener("keyup",a=>a.stopPropagation())}add(e,n,t,s,i){if(Object(t)===t)return new yi(this,e,n,t);const o=e[n];switch(typeof o){case"number":return new bi(this,e,n,t,s,i);case"boolean":return new ui(this,e,n);case"string":return new wi(this,e,n);case"function":return new Ve(this,e,n)}console.error(`gui.add failed
	property:`,n,`
	object:`,e,`
	value:`,o)}addColor(e,n,t=1){return new Ai(this,e,n,t)}addFolder(e){return new ot({parent:this,title:e})}load(e,n=!0){return e.controllers&&this.controllers.forEach(t=>{t instanceof Ve||t._name in e.controllers&&t.load(e.controllers[t._name])}),n&&e.folders&&this.folders.forEach(t=>{t._title in e.folders&&t.load(e.folders[t._title])}),this}save(e=!0){const n={controllers:{},folders:{}};return this.controllers.forEach(t=>{if(!(t instanceof Ve)){if(t._name in n.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);n.controllers[t._name]=t.save()}}),e&&this.folders.forEach(t=>{if(t._title in n.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);n.folders[t._title]=t.save()}),n}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const n=this.$children.clientHeight;this.$children.style.height=n+"px",this.domElement.classList.add("transition");const t=i=>{i.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",t))};this.$children.addEventListener("transitionend",t);const s=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=s+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(n=>n.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(n=>{e=e.concat(n.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(n=>{e=e.concat(n.foldersRecursive())}),e}}const C=new ot,F=new en(li,Z().ratio,hi,di),an={x:-280,y:-30,z:0},Se=(l,e,n,t)=>{for(const s in l)ce({from:e[s],to:l[s],onStep:i=>{e[s]=i,n&&n()},step:100,onComplete:t})},Ti=()=>{Se(an,F.position),C.add(F.position,"x",-500,500),C.add(F.position,"y",-500,500),C.add(F.position,"z",-500,500),C.onChange(()=>F.updateProjectionMatrix())};Ti();const Ei=new us(16777215,1),L=new Xt(13421772,10);L.position.set(2e3,2500,-1500);L.castShadow=!0;L.shadow.radius=1;L.shadow.mapSize.set(2048,2048);L.shadow.camera.near=.5;L.shadow.camera.far=5e3;L.shadow.camera.top=1e3;L.shadow.camera.bottom=-5e3;L.shadow.camera.left=-3e3;L.shadow.camera.right=1e3;const be=new j;be.position.set(-100,-120,0);const ee=new j;ee.position.set(-100,-120,0);ee.add(new st(200));const xi=new j,_i=await rn("sky"),cn=(l,{rotation:e,scale:n,position:t})=>{l.scale.set(...n||[]),l.rotation.set(...(e||[]).map(s=>Math.PI/180*s)),l.position.set(...t||[])},N=new ps,Li=()=>{N.background=_i,N.add(Ei),N.add(L),N.add(new fs(L,100,"red")),N.add(new ms(L.shadow.camera)),C.add(L.shadow.camera,"near",0,10),C.add(L.shadow.camera,"far",0,5e3),C.add(L.shadow.camera,"left",-5e3,5e3),C.add(L.shadow.camera,"right",-5e3,5e3),C.add(L.shadow.camera,"top",-5e3,5e3),C.add(L.shadow.camera,"bottom",-5e3,5e3),C.add(L.shadow,"radius",-200,200),C.add(L.shadow.mapSize,"width",0,4096),C.add(L.shadow.mapSize,"height",0,4096),C.onChange(()=>{L.shadow.camera.updateProjectionMatrix()}),N.add(new st(500))},ln=l=>N.backgroundIntensity=l,hn=(l,e,n=100)=>{ce({from:l,to:e,onStep:t=>ln(t),step:n})},Ri=(l=0,e=1)=>hn(l,e),vi=(l=1,e=0)=>hn(l,e),Pe=new gs({antialias:!0});Pe.shadowMap.enabled=!0;const Si=()=>{const l=()=>{Pe.render(N,F),requestAnimationFrame(l)};l()},Mi=()=>{const l=()=>{const{width:e,height:n,ratio:t}=Z();Pe.setSize(e,n),F.aspect=t,F.updateProjectionMatrix()};window.addEventListener("resize",l),l()},dn=Pe.domElement,Le=new ys(F,dn),Ci=()=>{document.body.append(dn)},rt=[{name:"bricks",scale:[100,100,100],position:[0,0,0],rotation:[0,60,0],filename:"rocks/rock_01"},{name:"door",scale:[60,90,80],rotation:[0,-90,0],position:[0,0,0],filename:"rocks/rock_02"},{name:"menhir_petit",scale:[30,15,25],rotation:[0,30,0],position:[0,0,0],filename:"rocks/rock_03"},{name:"coin",scale:[80,80,80],rotation:[0,0,0],position:[0,50,0],filename:"props/prop_01"}];rt.length;const ki=await on(rt),Ii=async()=>{const l=new j;for(const[e,n]of ki.entries()){const t=await n;cn(t.children[0],rt[e]),l.add(t)}return l},Pi=await Ii(),Oi=()=>{const l=ri(Pi);return l.traverse(e=>{e.isMesh&&(e.material=e.material.clone(),e.material.transparent=!0,e.castShadow=!0)}),l},Di=564,Ni=368,ye=5,Fi=30,ae=368/2,et=564/2,ji=await rn("road"),Hi=(l,e)=>{const n=new j;for(let t=0;t<e;t++){const s=new j,i=t*et;for(let o=0;o<l;o++){const r=new Jt(new As(Di/2,Ni/2),new nt({side:Qt,map:ji}));r.rotation.set(0,Math.PI/2,Math.PI/2);const a=(Z().width-l*ae)/2+ae/2,{x:c}=it(a+o*ae);r.position.z=c,r.receiveShadow=!0,r.add(new st(50)),s.add(r)}s.position.y=i,n.add(s)}return n.rotateZ(-Math.PI/2),n},Bi=Hi(ye,Fi),at=[{name:"car_01",scale:[70,70,70],rotation:[0,0,0],position:[0,0,0],filename:"cars/car_01"},{name:"car_02",scale:[35,35,30],rotation:[0,0,0],position:[0,0,0],filename:"cars/car_02"},{name:"car_03",scale:[65,65,65],rotation:[0,0,0],position:[0,0,0],filename:"cars/car_03"}];at.length;const Gi=await on(at),Ui=async()=>{const l=new j;for(const[e,n]of Gi.entries()){const t=await n;cn(t,at[e]),l.add(t)}return l.traverse(e=>{e.castShadow!==void 0&&(e.castShadow=!0)}),l},Re=await Ui(),$i=1e3/30,un=1e3/15,zi=1e3/5,ve=0,tt=1,Gt=2,ct=2;class Vi{state=ve;blocks=[];selectedCar=0;ready(e){requestAnimationFrame(()=>{O(()=>{this.interaction=new Me(this),this.setCar(Re),this.setRoads(Bi),this.registerController(),e&&e()}),O.ready||this.ready(e)})}addBlock(e){this.blocks.push(e),ee.add(e.object)}removeBlock(e){const n=this.blocks.indexOf(e);this.blocks.splice(n,1),e.object.removeFromParent()}clearBlocks(){for(const e of this.blocks)e.offMove(),e.object.removeFromParent();this.blocks=[]}isTooMuchBlock(){}onGenerateBlock(){const e=()=>{const{acceleration:n,speed:t,max:s}=this.roads;if(!this.interaction.isReducing){const i=new Yi;i.acceleration=n,i.speed=t,i.onMove(),this.addBlock(i),i.onDeprecated(()=>{i.offMove(),this.removeBlock(i)})}this.generateBlockTimer=setTimeout(e,zi*(s/Math.max(t,ct)))};e()}offGenerateBlock(){clearInterval(this.generateBlockTimer)}setCar(e){this.car=new Wi(e.children[this.selectedCar].clone())}toggleCar(e){this.selectedCar+e===Re.children.length?this.selectedCar=0:this.selectedCar+e===-1?this.selectedCar=Re.children.length-1:this.selectedCar+=e,this.car.object.removeFromParent();const n=Re.children[this.selectedCar].clone();be.add(n),this.car.object=n}setRoads(e){this.roads=new le(e)}run(){this.state=ve,this.toggleCar(0),N.add(be),this.car.fitCar(),this.interaction.openStartPage(),this.interaction.closeEndPage()}start(){this.state=tt,be.removeFromParent(),ee.add(this.car.object),ee.add(this.roads.object),N.add(ee),this.car.registerController(),this.car.fitCar(),this.roads.reset(),this.roads.onMove(),this.onGenerateBlock(),this.onCheck(),this.interaction.closeStartPage(),this.interaction.openGamingPage()}stop(){this.state=Gt,ee.removeFromParent(),N.add(xi),this.car.dismissController(),this.roads.offMove(),this.offGenerateBlock(),this.offCheck(),this.clearBlocks(),this.interaction.closeGamingPage(),this.interaction.openEndPage()}onCheck(){this.check=setInterval(()=>{e:for(let e=0;e<this.blocks.length;e++){const n=this.blocks[e];if(this.car.check(n)&&!n.checked){switch(n.object.userData.name){case"coin":this.interaction.collectCoin(n);break;default:this.stop();break e}n.checked=!0}}},$i)}offCheck(){clearInterval(this.check)}registerController(){let e=!1;this.controller=({key:n,type:t})=>{switch(n){case" ":if(t==="keyup")switch(this.state){case ve:this.start();break;case tt:break;case Gt:this.run();break}break;case"ArrowLeft":case"ArrowRight":t==="keyup"&&this.state===ve&&(n==="ArrowLeft"?this.toggleCar(-1):this.toggleCar(1),this.car.fitCar());break;case"ArrowUp":case"ArrowDown":const s=n==="ArrowUp",i=t==="keydown",o=i&&s,r=i&&!s,a=o?1:r?e?-1:-2:e?-.5:-1;r&&!e&&(e=!0),!r&&e&&(e=!1),this.roads.acceleration=Math.abs(this.roads.acceleration)*a,this.roads.updateSpeed(this.roads.acceleration);for(const c of this.blocks)c.acceleration=Math.abs(c.acceleration)*a,c.updateSpeed(c.acceleration);this.interaction.isReducing=!o;break}},document.addEventListener("keydown",this.controller),document.addEventListener("keyup",this.controller)}dismissController(){document.removeEventListener("keydown",this.controller),document.removeEventListener("keyup",this.controller)}}class Me{score=0;time=0;isReducing=!0;constructor(e){this.game=e,this.useOrbitControls(),this.closeGamingPage(),this.closeEndPage()}flags={startPage:{carSelfRotate:!1}};doms={startPage:ge("startPage"),gamingPage:ge("gamingPage"),endPage:ge("endPage"),score:Qe(".score"),time:Qe(".time"),gamingTip:ge("gamingTip")};bounce(e){e.classList.add("bounce"),e.onanimationend=()=>e.classList.remove("bounce")}collectCoin(e){e.offMove();const{offsetLeft:n,offsetTop:t}=this.doms.score[0];let{x:s,y:i}=it(n,t);s+=e.z;const o=()=>{this.html(this.doms.score,++this.score),this.bounce(this.doms.score[0]),e.object.removeFromParent()},r=[];e.object.traverse(f=>f.isMesh&&r.push(f.material));const a=[e.object.position,e.object.position,e.object.scale,e.object.scale,e.object.scale].concat(r),c=["y","z","x","y","z"].concat(Array(r.length).fill("opacity")),h=[i,s,0,0,0].concat(Array(r.length).fill(0));let[d,p]=[0,a.length];for(const[f,m]of a.entries()){const A=c[f]==="opacity",y=c[f]==="y"&&m===e.object.position||A?60:100;ce({from:m[c[f]],to:h[f],onStep:w=>m[c[f]]=w,onComplete:()=>{A&&(m.visible=!1),++d===p&&o()},step:y})}}html(e,n){if(n===void 0)return e.innerHTML;e.forEach(t=>t.innerHTML=n)}static moveView(e){Se({z:le.getVerticalCenterPosition(e)},F.position)}openStartPage(){this.flags.startPage.carSelfRotate=!1;const e=()=>{this.flags.startPage.carSelfRotate||requestAnimationFrame(()=>{be.rotateY(.003*z.animationRatio),e()})};e(),ln(0),this.doms.startPage.style.opacity=1,this.html(this.doms.score,this.score=0),this.html(this.doms.time,`${this.time=0}`)}closeStartPage(){this.flags.startPage.carSelfRotate=!0,this.doms.startPage.style.opacity=0}startTimer(){this.timer=setInterval(()=>{this.html(this.doms.time,`${++this.time}`)},1e3)}stopTimer(){clearInterval(this.timer)}showGamingTip(){const e=this.doms.gamingTip;e.style.display="block",requestAnimationFrame(()=>{e.classList.add("animation")}),e.ontransitionend=()=>{e.classList.remove("animation"),e.style.display="none"}}openGamingPage(){Ri(),this.doms.gamingPage.style.opacity=1,this.showGamingTip(),this.startTimer()}closeGamingPage(){this.doms.gamingPage.style.opacity=0,this.stopTimer()}openEndPage(){this.doms.endPage.style.opacity=1,vi()}closeEndPage(){this.doms.endPage.style.opacity=0}useOrbitControls(){Le.addEventListener("end",ai(()=>{const e={z:le.getVerticalCenterPosition(this.game.car.roadIndex)};Se({...an,...this.game.state===tt?e:null},F.position,Le.update),Se({x:0,y:0,...e},Le.target,Le.update)},1500))}}class pn{constructor(e){this.speed=e,this.acceleration=this.speed/100,this.max=e*10,this.min=0,this.canAccelerate(!0),this.canOverMax(!1)}reset(){this.speed=this.min,this.acceleration*=this.acceleration>=0?-1:1}updateSpeed(e){this.speed+=e}overMin(){const e=this.speed<this.min;return e&&(this.speed=this.min),e}inRange(){return!this.overMin()&&!this.overMax()}overMax(){const e=this.speed>this.max;return e&&(this.speed=this.max),e}canAccelerate(e){this.accelerated=e}canOverMax(e){this.limited=!e}forward(e){this.moving=!0;const n=()=>{let t=this.accelerated?this.acceleration:0;this.moving&&(this.limited&&!this.inRange()&&(t=0),e&&e(this.speed),this.speed+=t,requestAnimationFrame(n))};n()}halt(){this.moving=!1}}const Ki=5,Xi=4;class Yi extends pn{x=0;z=0;checked=!1;constructor(e=ct){super(e*z.animationRatio),this.object=Oi(),this.decorate();const{height:n}=Z(),t=Ze(Xi,Ki);this.set(n*t*2,le.getVerticalCenterPosition(Ze(0,4))),this.reset()}decorate(){const e=this.object;if(e.userData.name==="coin"){const n=()=>{requestAnimationFrame(()=>{this.moving&&(e.rotateY(.05*z.animationRatio),n())})};n()}e.traverse(n=>{n.isMesh&&ce({from:0,to:1,onStep:t=>n.material.opacity=t,step:200})})}set(e,n){this.object.position.setX(e),this.object.position.setZ(n),this.x=e,this.z=n}onMove(){this.forward(e=>{this.set(this.x-e,this.z)})}offMove(){this.halt()}onDeprecated(e){this.deprecated=setInterval(()=>{this.x<0&&Math.abs(this.x)>Z().height&&(clearInterval(this.deprecated),e&&e())},un)}}class Wi{roadIndex=Math.floor(ye/2);check(e){const{position:{x:n,z:t},children:{0:{scale:{x:s,z:i}}}}=e.object,{position:{x:o,z:r},scale:{x:a,z:c}}=this.object,h=Math.abs(n-o)<=a/2+s/2,d=Math.abs(t-r)<=c/2+i/2;return h&&d}constructor(e){this.object=e.clone()}fitCar(){this.roadIndex=Math.floor(ye/2),this.object.position.set(0,0,0),this.object.rotation.set(0,Math.PI/2,0),Me.moveView(this.roadIndex)}toLeft(){this.roadIndex>0&&ce({from:this.object.position.z,to:le.getVerticalCenterPosition(--this.roadIndex),onStep:e=>this.object.position.setZ(e)})}toRight(){this.roadIndex<ye-1&&ce({from:this.object.position.z,to:le.getVerticalCenterPosition(++this.roadIndex),onStep:e=>this.object.position.setZ(e)})}registerController(){this.control=({key:e})=>{switch(e){case"ArrowLeft":this.toLeft(),Me.moveView(this.roadIndex);break;case"ArrowRight":this.toRight(),Me.moveView(this.roadIndex);break}},document.addEventListener("keydown",this.control)}dismissController(){document.removeEventListener("keydown",this.control)}}class le extends pn{x=0;constructor(e,n=ct){super(n*z.animationRatio),this.object=e,this.reset(),this.onDeprecated(()=>{const t=this.object.children[0].removeFromParent();t.position.y=this.object.children[this.object.children.length-1].position.y+et,this.object.add(t)})}static getVerticalCenterPosition(e){const n=(Z().width-ye*ae)/2+ae/2,{x:t}=it(n+e*ae);return t}onMove(){this.forward(e=>{this.set(this.x-e)})}set(e){this.object.position.setX(e),this.x=e}offMove(){this.halt()}onDeprecated(e){this.deprecated=setInterval(()=>{const{x:n}=this.object.children[0].getWorldPosition(new v);n<0&&Math.abs(n)>Z().height&&e&&e()},un)}restoreRoad(){const e=this.object.children;for(let n=0,t=this.object.children;n<t;n++)e[n].position.y=n*et}reset(){super.reset(),this.restoreRoad()}}Mi();Si();Ci();Li();const Ut=new Vi;Ut.ready(()=>Ut.run());
